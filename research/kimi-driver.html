<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kimi Driver TOC Demo</title>
    <style>
        body { display: flex; margin: 0; font-family: sans-serif; overflow: hidden; /* Prevent body scroll */ }
        
        /* Kimi App Structure */
        .app.has-sidebar { display: flex; width: 100vw; height: 100vh; }
        .sidebar-placeholder { flex-shrink: 0; width: 240px; /* Kimi's sidebar width */ background-color: #f7f7f7; overflow-y: auto; }
        .sidebar { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .sidebar-header { padding: 15px; border-bottom: 1px solid #eee; }
        .sidebar-nav { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .sidebar-footer { padding: 15px; border-top: 1px solid #eee; }
        .main { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }

        /* Chat Page Structure */
        .chat-page { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        .chat-detail-content { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        .chat-detail-main { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        .chat-header { padding: 15px 20px; border-bottom: 1px solid #eee; flex-shrink: 0; }
        .chat-header-content h2 { margin: 0; font-size: 1.2em; }
        .chat-content-container { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .chat-content-list { padding-bottom: 100px; /* Space for input */ }
        .chat-content-item { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; background-color: #fff; }
        .chat-content-item-user { background-color: #e6f7ff; text-align: right; border-color: #cce5ff; }
        .chat-content-item-assistant { background-color: #f9f9f9; text-align: left; border-color: #eee; }
        .user-content, .paragraph { margin: 0; padding: 5px 0; line-height: 1.6; }

        /* Input area styles */
        .chat-action { padding: 10px 20px; border-top: 1px solid #eee; background-color: #fff; flex-shrink: 0; }
        .chat-editor { display: flex; align-items: center; }
        .chat-input { flex-grow: 1; margin-right: 10px; }
        .chat-input-editor { border: 1px solid #ccc; padding: 8px; min-height: 40px; border-radius: 8px; outline: none; }
        .send-button-container { flex-shrink: 0; }
        .send-button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        /* History part (sidebar) */
        .history-part ul { list-style: none; padding: 0; margin: 0; }
        .history-part li { margin-bottom: 5px; }
        .chat-info-item { display: block; padding: 8px; background-color: #f0f0f0; border-radius: 4px; text-decoration: none; color: #333; }
        .chat-info-item:hover { background-color: #e0e0e0; }

        /* Floating TOC (new) */
        #floating-toc {
            position: fixed; /* Fixed relative to viewport */
            top: 100px; /* Adjust as needed */
            left: calc(240px + 20px); /* Sidebar width + some margin */
            z-index: 1000; /* Ensure it's on top of everything */
            display: flex;
            flex-direction: column;
            gap: 5px;
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background */
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            backdrop-filter: blur(2px); /* Optional: for frosted glass effect */
        }
        #floating-toc .toc-item {
            width: 28px; /* Diameter of the circle */
            height: 28px;
            border-radius: 50%; /* Make it a circle */
            background-color: #007bff; /* Blue circle */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }
        #floating-toc .toc-item:hover { background-color: #0056b3; transform: scale(1.1); }
        #floating-toc .toc-item.active { background-color: #dc3545; /* Active color */ transform: scale(1.1); }
    </style>
</head>
<body>
    <div class="app has-sidebar">
        <div class="sidebar-placeholder">
            <aside class="sidebar">
                <div class="sidebar-header">Kimi Sidebar</div>
                <div class="sidebar-nav">
                    <!--ClickLog Start--><a data-v-7da636d8="" href="/" class="new-chat-btn">
                        <div data-v-7da636d8="" class="action-label"> 新建会话</div>
                        <div data-v-7da636d8="" class="action-opts">
                            <div data-v-7da636d8="" class="meta"><span data-v-7da636d8="">⌘</span></div> <span data-v-7da636d8=""
                                class="meta">K</span>
                        </div>
                    </a><!--ClickLog End-->
                    <!-- History Part (copied from tests/kimi.html) -->
                    <div class="history-part" data-v-7da636d8="">
                        <div class="nav-title" data-v-7da636d8="">
                            <div class="title-label" data-v-7da636d8=""><svg xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img"
                                    name="History" class="nav-icon iconify" data-v-7da636d8="" style=""
                                    width="20" height="20" viewBox="0 0 1024 1024">
                                    <path
                                        d="M512 81.066"
                                        fill="currentColor"></path>
                                </svg> <span data-v-7da636d8="">历史会话</span></div>
                        </div>
                        <ul>
                            <li class=""><a data-v-78bddd9f="" aria-current="page"
                                    href="/chat/d2uhndq1ol7rh07d015g"
                                    class="router-link-active router-link-exact-active chat-info-item">
                                    <div data-v-78bddd9f="" class="chat-info"><!----> <span data-v-78bddd9f=""
                                            class="chat-name">宇宙速度换算马赫值</span></div> <!---->
                                    <div data-v-78bddd9f="" class="more-btn"><svg data-v-78bddd9f=""
                                            xmlns="http://www.w3.org/2000/svg"
                                            xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                                            role="img" name="More" width="16" height="16"
                                            viewBox="0 0 1024 1024">
                                            <path
                                                d="M266.24 524"
                                                fill="currentColor"></path>
                                        </svg></div><!---->
                                </a></li>
                            <li class=""><a data-v-78bddd9f=""
                                    href="/chat/d2tqtneg0jbbvgjdq44g" class="chat-info-item">
                                    <div data-v-78bddd9f="" class="chat-info"><!----> <span data-v-78bddd9f=""
                                            class="chat-name">非结构化数据脱敏软件厂商及产品支持情况</span></div> <!---->
                                    <div data-v-78bddd9f="" class="more-btn"><svg data-v-78bddd9f=""
                                            xmlns="http://www.w3.org/2000/svg"
                                            xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                                            role="img" name="More" width="16" height="16"
                                            viewBox="0 0 1024 1024">
                                            <path
                                                d="M266.24 524"
                                                fill="currentColor"></path>
                                        </svg></div><!---->
                                </a></li>
                            <li class=""><a data-v-78bddd9f=""
                                    href="/chat/d2s05f7hq49l5d6ed880" class="chat-info-item">
                                    <div data-v-78bddd9f="" class="chat-info"><!----> <span data-v-78bddd9f=""
                                            class="chat-name">06:00~07:59高风险触发次数最多折线图数据</span></div> <!----> 
                                </a></li>
                            <li class=""><a data-v-78bddd9f=""
                                    href="/chat/d2r9pcs7fff33ah0i1fg" class="chat-info-item">
                                    <div data-v-78bddd9f="" class="chat-info"><!----> <span data-v-78bddd9f=""
                                            class="chat-name">数据安全研究中心未来两年工作计划</span></div> <!----> 
                                </a></li>
                            <li class=""><a data-v-78bddd9f=""
                                    href="/chat/d2r6kf0s8jdl37gbinkg" class="chat-info-item">
                                    <div data-v-78bddd9f="" class="chat-info"><!----> <span data-v-78bddd9f=""
                                            class="chat-name">Elasticsearch集群流量审计与明文流量捕获</span></div> <!----> 
                                </a></li>
                        </ul>
                    </div>
                </div>
                <div class="sidebar-footer">Kimi Footer</div>
            </aside>
        </div>
        <div class="main">
            <div class="chat-page chat">
                <div class="chat-detail-content">
                    <div class="chat-detail-main">
                        <div class="chat-header">
                            <header class="chat-header-content">
                                <h2 class="session-title">未命名会话</h2>
                            </header>
                        </div>
                        <div class="chat-content-container">
                            <div class="chat-content-list">
                                <!-- User and Assistant Messages -->
                                <div class="chat-content-item chat-content-item-user">
                                    <div class="segment segment-user">
                                        <div class="segment-container">
                                            <div class="segment-content">
                                                <div class="segment-content-box">
                                                    <div class="user-content">我现在做一个简单的测试，请每一句话都用不超过50个字回复我。</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-assistant">
                                        <div class="segment segment-assistant">
                                            <div class="segment-content">
                                                <div class="paragraph">好的，我尽量做到。</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-user">
                                        <div class="segment segment-user">
                                            <div class="segment-content">
                                                <div class="user-content">第一个问题：将第一宇宙速度、第二宇宙速度转化为马赫表示</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-assistant">
                                        <div class="segment segment-assistant">
                                            <div class="segment-content">
                                                <div class="paragraph">第一宇宙速度约7.9千米/秒，第二宇宙速度约11.2千米/秒。</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-user">
                                        <div class="segment segment-user">
                                            <div class="segment-content">
                                                <div class="user-content">马赫是指音速，第一宇宙速度和第二宇宙速度对应多少马赫</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-assistant">
                                        <div class="segment segment-assistant">
                                            <div class="segment-content">
                                                <div class="paragraph">音速约340米/秒。第一宇宙速度约23.2马赫，第二宇宙速度约33马赫。</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-user">
                                        <div class="segment segment-user">
                                            <div class="segment-content">
                                                <div class="user-content">有没有第三宇宙速度</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-assistant">
                                        <div class="segment segment-assistant">
                                            <div class="segment-content">
                                                <div class="paragraph">有，第三宇宙速度约16.7千米/秒，约合49马赫。</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-user">
                                        <div class="segment segment-user">
                                            <div class="segment-content">
                                                <div class="user-content">有没有第四宇宙速度</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-assistant">
                                        <div class="segment segment-assistant">
                                            <div class="segment-content">
                                                <div class="paragraph">有第四宇宙速度，它是指物体摆脱银河系引力束缚所需的最小速度。</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-user">
                                        <div class="segment segment-user">
                                            <div class="segment-content">
                                                <div class="user-content">谈下每个宇宙速度的作用</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-assistant">
                                        <div class="segment segment-assistant">
                                            <div class="segment-content">
                                                <div class="paragraph">第一宇宙速度：环绕地球飞行，卫星轨道运行。</div>
                                                <div class="paragraph">第二宇宙速度：摆脱地球引力，飞向太阳系其他天体。</div>
                                                <div class="paragraph">第三宇宙速度：摆脱太阳引力，飞出太阳系。</div>
                                                <div class="paragraph">第四宇宙速度：摆脱银河系引力，飞向银河系外。</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-user">
                                        <div class="segment segment-user">
                                            <div class="segment-content">
                                                <div class="user-content">这是一个很长的问题，用来测试滚动条和TOC的固定位置。请用一个很长的回答来回复我，这样我们可以看到滚动效果。</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-content-item chat-content-item-assistant">
                                        <div class="segment segment-assistant">
                                            <div class="segment-content">
                                                <div class="paragraph">好的，这是一个关于宇宙速度的详细解释，它涵盖了从地球轨道到银河系外的所有关键概念。第一宇宙速度，又称环绕速度，是指物体在地球表面附近绕地球做匀速圆周运动所必须具备的速度。它的数值大约是7.9千米/秒。如果物体的速度达到并保持在这个数值，它就可以在不借助任何动力的情况下，持续围绕地球运行，成为一颗人造地球卫星。这个速度是发射近地轨道卫星的基础。</div>
                                                <div class="paragraph">第二宇宙速度，又称脱离速度，是指物体摆脱地球引力束缚，飞离地球所需的最小速度。它的数值大约是11.2千米/秒。当航天器的速度达到这个数值时，它就可以脱离地球的引力范围，飞向太阳系内的其他行星，例如火星、金星等。探测器前往太阳系内行星的任务，都需要达到或超过这个速度。</div>
                                                <div class="paragraph">第三宇宙速度，又称逃逸速度，是指物体摆脱太阳引力束缚，飞出太阳系所需的最小速度。它的数值大约是16.7千米/秒。如果航天器的速度达到这个数值，它就可以脱离太阳的引力范围，飞向太阳系外的广阔宇宙空间，探索更遥远的星系。旅行者1号和2号探测器就是以超过第三宇宙速度的速度飞离太阳系的。</div>
                                                <div class="paragraph">第四宇宙速度，这是一个相对较新的概念，通常指的是物体摆脱银河系引力束缚所需的最小速度。由于银河系的巨大质量和引力范围，这个速度的数值非常大，估计在500千米/秒到1000千米/秒之间，甚至更高。目前人类还没有能力制造出能够达到第四宇宙速度的航天器。这个概念更多地存在于理论物理和科幻领域，代表着人类对宇宙更深层次探索的终极目标。</div>
                                                <div class="paragraph">总的来说，这些宇宙速度是天体物理学和航天工程中的基本概念，它们定义了物体在不同引力场中运动的临界条件，是人类探索宇宙的理论基础和实践指南。</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-action">
                                <div class="chat-editor">
                                    <div class="chat-input">
                                        <div contenteditable="true" class="chat-input-editor"></div>
                                        <div class="chat-input-placeholder">尽管问...</div>
                                    </div>
                                    <div class="chat-editor-action">
                                        <div class="right-area">
                                            <div class="send-button-container">
                                                <div class="send-button">发送</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="floating-toc">
        <!-- TOC items will be generated here -->
    </div>

    <script>
        // KimiPageDriverTOC-like implementation
        function KimiPageDriverTOC() {
            this.tocList = document.getElementById('floating-toc'); // Target the floating TOC container
            this.userContents = document.querySelectorAll('.chat-content-item-user .user-content');
            this.tocItems = [];

            this.init = function() {
                this.generateTOC();
                this.attachScrollListener();
                this.logSpecificElements();
            };

            this.generateTOC = function() {
                this.userContents.forEach((content, index) => {
                    const tocItemDiv = document.createElement('div');
                    tocItemDiv.className = 'toc-item';
                    tocItemDiv.textContent = `${index + 1}`; // Only display number
                    tocItemDiv.dataset.index = index;
                    this.tocList.appendChild(tocItemDiv);
                    // Store a reference to the parent chat-content-item for scrolling
                    this.tocItems.push({ link: tocItemDiv, element: content.closest('.chat-content-item') });

                    tocItemDiv.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.scrollToQuestion(index);
                    });
                });
            };

            this.scrollToQuestion = function(index) {
                this.tocItems[index].element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                this.updateActiveTOCItem(index);
            };

            this.updateActiveTOCItem = function(activeIndex) {
                this.tocItems.forEach((item, idx) => {
                    if (idx === activeIndex) {
                        item.link.classList.add('active');
                    } else {
                        item.link.classList.remove('active');
                    }
                });
            };

            this.attachScrollListener = function() {
                let activeIndex = -1;
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const currentElementIndex = this.tocItems.findIndex(item => item.element === entry.target);
                            if (currentElementIndex !== -1 && currentElementIndex !== activeIndex) {
                                activeIndex = currentElementIndex;
                                this.updateActiveTOCItem(activeIndex);
                            }
                        }
                    });
                }, { root: null, rootMargin: '0px 0px -50% 0px', threshold: 0 }); // Trigger when top of element is in middle of viewport

                this.tocItems.forEach(item => observer.observe(item.element));
            };

            this.logSpecificElements = function() {
                console.log("--- Kimi Driver Demo Elements ---");

                // New Session Button
                const newSession = document.querySelector('a.new-chat-btn div.action-label');
                console.log(`新建会话按钮 (New Session Button): ${newSession ? newSession.textContent : 'N/A'}`);

                // History Sessions
                const historyPart = document.querySelector('.history-part');
                if (historyPart) {
                    const historyTitle = historyPart.querySelector('.title-label span');
                    console.log(`历史会话 (History Sessions) section found. Title: ${historyTitle ? historyTitle.textContent : 'N/A'}`);
                    const firstHistoryItem = historyPart.querySelector('.chat-info-item .chat-name');
                    console.log(`First history item: ${firstHistoryItem ? firstHistoryItem.textContent : 'N/A'}`);
                } else {
                    console.log("历史会话 (History Sessions) section NOT found.");
                }

                // Session Title
                const sessionTitle = document.querySelector('.chat-header-content h2');
                console.log(`会话标题 (Session Title): ${sessionTitle ? sessionTitle.textContent : 'N/A'}`);

                // Text Input Box
                const chatInputEditor = document.querySelector('.chat-input-editor');
                const chatInputPlaceholder = document.querySelector('.chat-input-placeholder');
                console.log(`文本输入框 (Text Input Box) found. Placeholder: ${chatInputPlaceholder ? chatInputPlaceholder.textContent : 'N/A'}`);

                // Send Button
                const sendButton = document.querySelector('.send-button');
                console.log(`发送按钮 (Send Button) found. Text: ${sendButton ? sendButton.textContent : 'N/A'}`);

                console.log("---------------------------------");
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const driver = new KimiPageDriverTOC();
            driver.init();
        });
    </script>
</body>
</html>