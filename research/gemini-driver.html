<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gemini Driver TOC Demo</title>
    <style>
        body { display: flex; margin: 0; font-family: sans-serif; overflow: hidden; /* Prevent body scroll */ }
        
        /* Gemini App Structure (simplified) */
        .app-root { display: flex; width: 100vw; height: 100vh; }
        .side-nav-container { flex-shrink: 0; width: 280px; background-color: #f7f7f7; overflow-y: auto; display: flex; flex-direction: column; }
        .side-nav-header { padding: 15px; border-bottom: 1px solid #eee; }
        .side-nav-content { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .side-nav-footer { padding: 15px; border-top: 1px solid #eee; }
        .main-content-area { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }

        /* Chat Window Structure */
        .chat-container { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        .chat-history-scroll-container { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .conversation-container { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; background-color: #fff; }
        .user-query-container { background-color: #e6f7ff; text-align: right; border-color: #cce5ff; }
        .model-response-container { background-color: #f9f9f9; text-align: left; border-color: #eee; }
        .query-text, .paragraph { margin: 0; padding: 5px 0; line-height: 1.6; }

        /* Input area styles */
        .input-area-container { padding: 10px 20px; border-top: 1px solid #eee; background-color: #fff; flex-shrink: 0; }
        .text-input-field { display: flex; align-items: center; }
        .ql-editor { flex-grow: 1; border: 1px solid #ccc; padding: 8px; min-height: 40px; border-radius: 8px; outline: none; }
        .send-button-container { flex-shrink: 0; margin-left: 10px; }
        .send-button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        /* Floating TOC */
        #floating-toc {
            position: fixed; /* Fixed relative to viewport */
            top: 20px; /* Adjust as needed */
            left: calc(280px + 20px); /* Sidebar width + some margin */
            z-index: 1000; /* Ensure it's on top of everything */
            display: flex;
            flex-direction: column;
            gap: 5px;
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background */
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            backdrop-filter: blur(2px); /* Optional: for frosted glass effect */
        }
        #floating-toc .toc-item {
            width: 28px; /* Diameter of the circle */
            height: 28px;
            border-radius: 50%; /* Make it a circle */
            background-color: #007bff; /* Blue circle */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }
        #floating-toc .toc-item:hover { background-color: #0056b3; transform: scale(1.1); }
        #floating-toc .toc-item.active { background-color: #dc3545; /* Active color */ transform: scale(1.1); }
    </style>
</head>
<body>
    <div class="app-root">
        <div class="side-nav-container">
            <div class="side-nav-header">Gemini Sidebar</div>
            <div class="side-nav-content">
                <!-- New Chat Button -->
                <button data-test-id="new-chat-button" aria-label="发起新对话" class="new-chat-button">发起新对话</button>

                <!-- History Sessions (simplified from Gemini HTML) -->
                <div class="chat-history">
                    <div class="title-container">
                        <h1 class="title">近期对话</h1>
                    </div>
                    <div class="conversations-container">
                        <div data-test-id="conversation" class="conversation">
                            <div class="conversation-title">简短回复测试</div>
                        </div>
                        <div data-test-id="conversation" class="conversation">
                            <div class="conversation-title">分类分级工具的架构选型讨论</div>
                        </div>
                        <div data-test-id="conversation" class="conversation">
                            <div class="conversation-title">AI赋能医院防统方智能定位</div>
                        </div>
                        <div data-test-id="conversation" class="conversation">
                            <div class="conversation-title">医疗数据安全项目参数优化</div>
                        </div>
                        <div data-test-id="conversation" class="conversation">
                            <div class="conversation-title">乌克兰参战伊拉克战争考证</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="side-nav-footer">Gemini Footer</div>
        </div>
        <div class="main-content-area">
            <div class="chat-container">
                <div class="chat-history-scroll-container">
                    <!-- User and Model Responses -->
                    <div class="conversation-container">
                        <div class="user-query-container">
                            <div class="query-text">我现在做一个简单的测试，请每一句话都用不超过50个字回复我。</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="model-response-container">
                            <div class="paragraph">好的，明白你的要求。</div>
                            <div class="paragraph">我将用不超过50个字来回复你每一句话。</div>
                            <div class="paragraph">请开始你的测试吧。</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="user-query-container">
                            <div class="query-text">第一个问题：将第一宇宙速度、第二宇宙速度转化为马赫表示</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="model-response-container">
                            <div class="paragraph">根据公开数据，第一宇宙速度为 7.9 km/s，第二宇宙速度为 11.2 km/s。马赫数是物体速度与当地音速的比值。</div>
                            <div class="paragraph">由于音速随环境条件（如温度、密度）而变化，马赫数并非一个固定的速度值。在海平面标准大气压下，音速约为 340 m/s，即 0.34 km/s。</div>
                            <div class="paragraph">第一宇宙速度（7.9 km/s）转换为马赫：马赫数 = 7.9 km/s / 0.34 km/s ≈ 23.2 Ma</div>
                            <div class="paragraph">第二宇宙速度（11.2 km/s）转换为马赫：马赫数 = 11.2 km/s / 0.34 km/s ≈ 32.9 Ma</div>
                            <div class="paragraph">需要注意的是，这些数值是在海平面标准大气压下的粗略换算，实际的马赫数会因所在高度和大气条件的变化而有所不同。</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="user-query-container">
                            <div class="query-text">有没有第三宇宙速度</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="model-response-container">
                            <div class="paragraph">有的，第三宇宙速度是物体从地球上发射，并最终脱离太阳系引力束缚所需的最低初始速度。</div>
                            <div class="paragraph">这个速度大约是 16.7 km/s。</div>
                            <div class="paragraph">与前两个宇宙速度相比，第一宇宙速度是环绕地球，第二宇宙速度是脱离地球引力进入太阳系，而第三宇宙速度则是要彻底飞出太阳系，前往更遥远的宇宙空间。</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="user-query-container">
                            <div class="query-text">有没有第四宇宙速度</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="model-response-container">
                            <div class="paragraph">有的，第四宇宙速度是物体从地球上发射，并最终脱离银河系引力束缚所需的最低初始速度。</div>
                            <div class="paragraph">这个速度的计算非常复杂，因为我们对银河系的质量和引力分布了解得还不够精确。目前，科学家们粗略估计其数值约为 525 km/s，这远远超过了目前任何航天器的速度。</div>
                            <div class="paragraph">虽然这个概念在理论上是存在的，但对人类来说，目前并没有实际意义。</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="user-query-container">
                            <div class="query-text">谈下每个宇宙速度的作用</div>
                        </div>
                    </div>
                    <div class="conversation-container">
                        <div class="model-response-container">
                            <div class="paragraph">第一宇宙速度：环绕地球飞行，卫星轨道运行。</div>
                            <div class="paragraph">第二宇宙速度：摆脱地球引力，飞向太阳系其他天体。</div>
                            <div class="paragraph">第三宇宙速度：摆脱太阳引力，飞出太阳系。</div>
                            <div class="paragraph">第四宇宙速度：摆脱银河系引力，飞向银河系外。</div>
                        </div>
                    </div>
                </div>
                <div class="input-area-container">
                    <div class="text-input-field">
                        <div class="ql-editor" data-placeholder="问问 Gemini"></div>
                    </div>
                    <div class="send-button-container">
                        <button aria-label="发送" class="send-button">发送</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="floating-toc">
        <!-- TOC items will be generated here -->
    </div>

    <script>
        function GeminiPageDriverTOC() {
            this.tocList = document.getElementById('floating-toc');
            this.userContents = document.querySelectorAll('.query-text'); // Selector for Gemini user prompts
            this.tocItems = [];

            this.init = function() {
                this.generateTOC();
                this.attachScrollListener();
                this.logSpecificElements();
            };

            this.generateTOC = function() {
                this.userContents.forEach((content, index) => {
                    const tocItemDiv = document.createElement('div');
                    tocItemDiv.className = 'toc-item';
                    tocItemDiv.textContent = `${index + 1}`;
                    tocItemDiv.dataset.index = index;
                    this.tocList.appendChild(tocItemDiv);
                    this.tocItems.push({ link: tocItemDiv, element: content.closest('.conversation-container') });

                    tocItemDiv.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.scrollToQuestion(index);
                    });
                });
            };

            this.scrollToQuestion = function(index) {
                this.tocItems[index].element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                this.updateActiveTOCItem(index);
            };

            this.updateActiveTOCItem = function(activeIndex) {
                this.tocItems.forEach((item, idx) => {
                    if (idx === activeIndex) { item.link.classList.add('active'); } else { item.link.classList.remove('active'); }
                });
            };

            this.attachScrollListener = function() {
                let activeIndex = -1;
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const currentElementIndex = this.tocItems.findIndex(item => item.element === entry.target);
                            if (currentElementIndex !== -1 && currentElementIndex !== activeIndex) {
                                activeIndex = currentElementIndex;
                                this.updateActiveTOCItem(activeIndex);
                            }
                        }
                    });
                }, { root: null, rootMargin: '0px 0px -50% 0px', threshold: 0 });

                this.tocItems.forEach(item => observer.observe(item.element));
            };

            this.logSpecificElements = function() {
                console.log("--- Gemini Driver Demo Elements ---");

                // History Sessions
                const historyTitle = document.querySelector('.chat-history .title');
                console.log(`历史会话 (History Sessions) title: ${historyTitle ? historyTitle.textContent.trim() : 'N/A'}`);
                const firstHistoryItem = document.querySelector('.conversations-container [data-test-id="conversation"] .conversation-title');
                console.log(`First history item: ${firstHistoryItem ? firstHistoryItem.textContent.trim() : 'N/A'}`);

                // Session Title
                const sessionTitle = document.querySelector('.chat-header-content h2');
                console.log(`会话标题 (Session Title): ${sessionTitle ? sessionTitle.textContent.trim() : 'N/A'}`);

                // Text Input Box
                const chatInputEditor = document.querySelector('.ql-editor');
                const chatInputPlaceholder = document.querySelector('.ql-editor[data-placeholder]');
                console.log(`文本输入框 (Text Input Box) found. Placeholder: ${chatInputPlaceholder ? chatInputPlaceholder.dataset.placeholder : 'N/A'}`);

                // Send Button
                const sendButton = document.querySelector('.send-button');
                console.log(`发送按钮 (Send Button) found. Text: ${sendButton ? sendButton.textContent.trim() : 'N/A'}`);

                // New Chat Button
                const newChatButton = document.querySelector('button[data-test-id="new-chat-button"]');
                console.log(`新建会话 (New Chat) button found. Text: ${newChatButton ? newChatButton.textContent.trim() : 'N/A'}`);

                console.log("---------------------------------");
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const driver = new GeminiPageDriverTOC();
            driver.init();
        });
    </script>
</body>
</html>
