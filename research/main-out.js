console.log('Initializing main window.');
debugger;
window.mainWindowName = 'multi-ai-chat-main-window';
/*! For license information please see main-window-initializer.bundle.js.LICENSE.txt */
var MainWindowInitializer; (() => { var t = { 27: (t, e, n) => { function i(t) { return i = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t }, i(t) } function o(t, e) { var n = Object.keys(t); if (Object.getOwnPropertySymbols) { var i = Object.getOwnPropertySymbols(t); e && (i = i.filter(function (e) { return Object.getOwnPropertyDescriptor(t, e).enumerable })), n.push.apply(n, i) } return n } function r(t) { for (var e = 1; e < arguments.length; e++) { var n = null != arguments[e] ? arguments[e] : {}; e % 2 ? o(Object(n), !0).forEach(function (e) { s(t, e, n[e]) }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(n)) : o(Object(n)).forEach(function (e) { Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(n, e)) }) } return t } function s(t, e, n) { return (e = function (t) { var e = function (t, e) { if ("object" != i(t) || !t) return t; var n = t[Symbol.toPrimitive]; if (void 0 !== n) { var o = n.call(t, e || "default"); if ("object" != i(o)) return o; throw new TypeError("@@toPrimitive must return a primitive value.") } return ("string" === e ? String : Number)(t) }(t, "string"); return "symbol" == i(e) ? e : e + "" }(e)) in t ? Object.defineProperty(t, e, { value: n, enumerable: !0, configurable: !0, writable: !0 }) : t[e] = n, t } n(892); t.exports = function (t) { var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; if (!t) throw new Error("Storage instance must be provided to Config."); this.storage = t; var n = e, i = {}, o = "user-config"; this.init = function () { var t = this.storage.get(o, {}); i = r(r({}, n), t) }, this.get = function (t) { var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : void 0; return void 0 !== e && void 0 === i[t] ? e : void 0 === i[t] ? null : i[t] }, this.set = function (t, e) { i[t] = e; var n = this.storage.get(o, {}); n[t] = e, this.storage.set(o, n) }, this.getAll = function () { return r({}, i) }, this.restoreDefaults = function () { i = r({}, n), this.storage.remove(o) }, this.init() } }, 89: (t, e, n) => { var i = n(540), o = n(825); t.exports = function (t, e, n, r, s) { var a = this, c = new i, l = new o; this.mainController = t, this.id = e, this.url = n, this.container = r, this.i18n = s, this.element = null, this.hideTimeout = null, this.pinned = !1, this.eventHandlers = { onEvtClose: function (t) { }, onEvtNewSession: function (t, e) { }, onEvtShare: function (t, e) { }, onEvtParamChanged: function (t, e, n, i) { }, onEvtProviderChanged: function (t, e, n) { }, onEvtPromptSend: function (t, e) { }, onEvtExport: function () { } }, this.setEventHandler = function (t, e) { var n = "", i = t.toLowerCase(); i != "onEvtClose".toLowerCase() && i != "Close".toLowerCase() || (n = "onEvtClose"), i != "onEvtNewSession".toLowerCase() && i != "NewSession".toLowerCase() || (n = "onEvtNewSession"), i != "onEvtShare".toLowerCase() && i != "Share".toLowerCase() || (n = "onEvtShare"), i != "onEvtParamChanged".toLowerCase() && i != "ParamChanged".toLowerCase() || (n = "onEvtParamChanged"), i != "onEvtProviderChanged".toLowerCase() && i != "ProviderChanged".toLowerCase() || (n = "onEvtProviderChanged"), i != "onEvtPromptSend".toLowerCase() && i != "PromptSend".toLowerCase() || (n = "onEvtPromptSend"), i != "onEvtExport".toLowerCase() && i != "Export".toLowerCase() || (n = "onEvtExport"), n.length > 0 && (this.eventHandlers[n] = e) }, this.init = function (t) { var e = this.render(t); this.container.innerHTML = e, this.element = this.container.querySelector(".chat-area-instance"), this.url || this.element.classList.add("forced-selection"), this.pinned = t.pinned || !1, this.cacheDOMElements(), this.initEventListeners(), this.updatePinState() }, this.render = function (t) { var e = c.getProviders().map(function (t, e) { return '<div class="model-option" data-value="'.concat(t, '">').concat(t, "</div>") }).join(""), n = (t.params.models || []).map(function (t, e) { return "<option>".concat(t, "</option>") }).join(""), i = (t.conversation || []).filter(function (t) { return "answer" === t.type }), o = i.map(function (e, n) { return '<div class="index-item"><a href="#answer-'.concat(t.id, "-").concat(n, '">').concat(n + 1, "</a></div>") }).join(""), r = (t.conversation || []).map(function (e) { var n = ""; if ("answer" === e.type) { var o = i.indexOf(e); n = 'id="answer-'.concat(t.id, "-").concat(o, '"') } return '<div class="message-bubble '.concat(e.type, '" ').concat(n, '><div class="bubble-content">').concat(e.content, "</div></div>") }).join(""), s = this.url ? "" : '\n            <div class="forced-selection-overlay">\n                <div class="selection-hint" style="position: absolute; top: 10px; left: 10px; text-align: left; color: white; font-size: 1.2em; background-color: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px; z-index: 10; display: flex; align-items: center;">\n                    <div style="font-size: 2em; margin-right: 10px; line-height: 1;">↖️</div>\n                    <span data-lang-key="selectProviderHint">Please select an AI provider from the dropdown above to start chatting.</span>\n                </div>\n            </div>\n        ', a = this.url ? "model-selector" : "model-selector highlight-dropdown"; return '\n        <div class="chat-area-instance">\n            '.concat(s, '\n            <div class="chat-area-title">\n                <div class="title-left">\n                    <div class="').concat(a, '">\n                        <div class="model-name">').concat(t.providerName, '</div>\n                        <div class="model-dropdown-arrow">&#9662;</div> \x3c!-- 新增的箭头div --\x3e\n                        <div class="custom-dropdown model-dropdown">\n                            ').concat(e, '\n                        </div>\n                    </div>\n                    <div class="title-button new-session-button" title="New Session" data-lang-key="newSessionButtonTitle">&#10133;</div>\n                </div>\n                <div class="title-center">\n                    <div class="title-button expand-all" title="Expand All" data-lang-key="expandAllButtonTitle">&#x2924;</div>\n                    <div class="title-button collapse-all" title="Collapse All" data-lang-key="collapseAllButtonTitle">&#x2922;</div>\n                    <div class="title-button export-button" title="Export Content" data-lang-key="exportContentButtonTitle">&#128228;</div>\n                </div>\n                <div class="title-right">\n                    <div class="params-selector">\n                        <div class="title-button params-button" title="Parameters" data-lang-key="parametersButtonTitle">&#9881;</div>\n                        <div class="custom-dropdown params-dropdown">\n                            <div class="param-item" data-param-name="webAccess"><label data-lang-key="webAccessLabel">Web Access</label><label class="toggle-switch"><input type="checkbox" id="web-access-').concat(t.id, '" ').concat(t.params.webAccess ? "checked" : "", '><span class="slider"></span></label></div>\n                            <div class="param-item" data-param-name="longThought"><label data-lang-key="longThoughtLabel">Long Thought</label><label class="toggle-switch"><input type="checkbox" id="long-thought-').concat(t.id, '" ').concat(t.params.longThought ? "checked" : "", '><span class="slider"></span></label></div>\n                            <hr>\n                            <div class="param-item" data-param-name="modelVersion"><label data-lang-key="modelVersionLabel">Model Version</label>\n                                <select>').concat(n, '</select>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="title-button share-button" title="Share" data-lang-key="shareButtonTitle">&#128279;</div>\n                    <div class="title-button pin-button" title="Pin" data-lang-key="pinButtonTitle"><span class="icon">&#128204;</span></div>\n                    <div class="title-button close-button" title="Close" data-lang-key="closeButtonTitle">&#10006;</div>\n                </div>\n            </div>\n            <div class="chat-area-main">\n                <div class="chat-area-index">\n                    ').concat(o, '\n                </div>\n                <div class="chat-area-conversation">').concat(r, '</div>\n            </div>\n            <div class="input-placeholder" data-lang-key="inputPlaceholder">Input</div>\n            <div class="chat-area-input">\n                <textarea rows="1" placeholder="Type your message..." data-lang-key="typeMessagePlaceholder"></textarea>\n                <button title="Send" data-lang-key="sendButtonTitle">&#10148;</button>\n            </div>\n        </div>\n        ') }, this.cacheDOMElements = function () { this.mainArea = this.element.querySelector(".chat-area-main"), this.placeholder = this.element.querySelector(".input-placeholder"), this.inputArea = this.element.querySelector(".chat-area-input"), this.textarea = this.element.querySelector("textarea"), this.conversationArea = this.element.querySelector(".chat-area-conversation"), this.answerBubbles = this.element.querySelectorAll(".message-bubble.answer"), this.modelSelector = this.element.querySelector(".model-selector"), this.providerNameDisplay = this.modelSelector.querySelector(".model-name"), this.modelDropdown = this.modelSelector.querySelector(".model-dropdown"), this.paramsSelector = this.element.querySelector(".params-selector"), this.paramsButton = this.paramsSelector.querySelector(".params-button"), this.paramsDropdown = this.paramsSelector.querySelector(".params-dropdown") }, this.initEventListeners = function () { var t, e = this; this.pinButton = this.element.querySelector(".pin-button"), this.pinButton.addEventListener("click", function () { return e.setPin(!e.isPinned()) }), this.element.querySelector(".close-button").addEventListener("click", function () { e.eventHandlers.onEvtClose(e), e.mainController.removeChatArea(e.id) }), this.element.querySelector(".new-session-button").addEventListener("click", function () { e.eventHandlers.onEvtNewSession(e, e.getProvider()) }), this.element.querySelector(".share-button").addEventListener("click", function () { e.eventHandlers.onEvtShare(e, e.getUrl()) }), this.providerNameDisplay.addEventListener("click", function (t) { return e.toggleDropdown(t, e.modelDropdown) }), this.paramsButton.addEventListener("click", function (t) { return e.toggleDropdown(t, e.paramsDropdown) }), this.paramsDropdown.querySelector("select").addEventListener("focus", function (e) { t = e.target.value }), this.paramsDropdown.addEventListener("change", function (n) { var i, o, r, s = n.target, a = s.closest(".param-item"); a && (i = a.dataset.paramName, "checkbox" === s.type ? o = !(r = s.checked) : "SELECT" === s.tagName && (r = s.value, o = t), i && e.eventHandlers.onEvtParamChanged(e, i, r, o)) }), this.modelDropdown.querySelectorAll(".model-option").forEach(function (t) { t.addEventListener("click", function (t) { var n = e.getProvider(), i = t.currentTarget.dataset.value; if (e.providerNameDisplay.textContent = i, e.eventHandlers.onEvtProviderChanged(e, i, n), e.modelDropdown.classList.remove("visible"), e.element.classList.contains("forced-selection")) { e.element.classList.remove("forced-selection"); var o = e.element.querySelector(".forced-selection-overlay"); o && o.remove(), e.url = c.getProviderUrl(i) } }) }), this.element.querySelector(".expand-all").addEventListener("click", function () { return e.expandAll() }), this.element.querySelector(".collapse-all").addEventListener("click", function () { return e.collapseAll() }), this.element.querySelector(".export-button").addEventListener("click", function () { e.eventHandlers.onEvtExport(e) }), this.placeholder.addEventListener("mouseenter", function () { return e.showInput() }), this.inputArea.addEventListener("mouseenter", function () { return e.showInput() }), this.inputArea.addEventListener("mouseleave", function () { return e.undockInput() }), this.textarea.addEventListener("focus", function () { return e.dockInput() }), this.inputArea.addEventListener("focusout", function (t) { return e.handleFocusOut(t) }), this.inputArea.querySelector("button").addEventListener("click", function () { var t = e.textarea.value.trim(); t && (e.eventHandlers.onEvtPromptSend(e, t), e.textarea.value = "") }) }, this.isPinned = function () { return this.pinned }, this.setPin = function (t) { this.pinned = t, this.updatePinState(), this.mainController && this.mainController.updateLayout && this.mainController.updateLayout() }, this.updatePinState = function () { this.pinButton && this.pinButton.classList.toggle("pinned", this.pinned) }, this.updateProviderOptions = function (t) { var e = this, n = this.getProvider(); this.modelDropdown.querySelectorAll(".model-option").forEach(function (i) { var o = i.dataset.value; t.includes(o) && o !== n ? (i.classList.add("unavailable"), i.style.pointerEvents = "none", i.setAttribute("title", e.i18n.getText("providerUnavailable"))) : (i.classList.remove("unavailable"), i.style.pointerEvents = "auto", i.removeAttribute("title")) }) }, this.toggleDropdown = function (t, e) { if (t.stopPropagation(), e === this.modelDropdown) { var n = this.mainController.getUnavailableProviders(this.id); this.updateProviderOptions(n) } e.classList.toggle("visible") }, this.closeDropdowns = function () { this.modelDropdown.classList.remove("visible"), this.paramsDropdown.classList.remove("visible") }, this.expandAll = function () { return a.answerBubbles.forEach(function (t) { return t.classList.remove("collapsed") }) }, this.collapseAll = function () { return a.answerBubbles.forEach(function (t) { return t.classList.add("collapsed") }) }, this.showInput = function () { clearTimeout(this.hideTimeout), this.placeholder.classList.add("hidden"), this.inputArea.classList.add("visible") }, this.dockInput = function () { this.showInput(), this.inputArea.classList.add("docked"), this.mainArea.style.paddingBottom = "".concat(this.inputArea.offsetHeight, "px") }, this.undockInput = function () { var t = this; this.inputArea.classList.remove("docked"), this.mainArea.style.paddingBottom = "0px", this.hideTimeout = setTimeout(function () { t.inputArea.contains(document.activeElement) || (t.inputArea.classList.remove("visible"), t.placeholder.classList.remove("hidden")) }, 300) }, this.handleFocusOut = function (t) { this.inputArea.contains(t.relatedTarget) || this.undockInput() }, this.addMessage = function (t, e) { var n = Array.from(this.answerBubbles).length, i = "answer-".concat(this.id, "-").concat(n), o = { tag: "div", "@class": "message-bubble ".concat(e), "@id": "answer" === e ? i : "", child: [{ tag: "div", "@class": "bubble-content", innerHTML: t }] }, r = l.toHtml(o); if (this.conversationArea.appendChild(r), this.conversationArea.scrollTop = this.conversationArea.scrollHeight, "answer" === e) { var s = { tag: "div", "@class": "index-item", child: [{ tag: "a", "@href": "#".concat(i), text: "".concat(n + 1) }] }; this.element.querySelector(".chat-area-index").appendChild(l.toHtml(s)), this.answerBubbles = this.element.querySelectorAll(".message-bubble.answer") } }, this.destroy = function () { }, this.getProvider = function () { return this.providerNameDisplay.textContent.trim() }, this.getWebAccess = function () { return this.element.querySelector("#web-access-".concat(this.id)).checked }, this.getLongThought = function () { return this.element.querySelector("#long-thought-".concat(this.id)).checked }, this.getModelVersion = function () { return this.paramsDropdown.querySelector("select").value }, this.getUrl = function () { return this.url }, this.setWebAccess = function (t) { this.element.querySelector("#web-access-".concat(this.id)).checked = t }, this.setLongThought = function (t) { this.element.querySelector("#long-thought-".concat(this.id)).checked = t }, this.updateTitle = function (t) { console.log("ChatArea ".concat(this.id, ": Title updated to ").concat(t)) }, this.updateOption = function (t, e) { console.log("ChatArea ".concat(this.id, ": Option ").concat(t, " updated to ").concat(e)) }, this.addQuestion = function (t) { this.addMessage(t, "question") }, this.updateModelVersion = function (t) { console.log("ChatArea ".concat(this.id, ": Model version updated to ").concat(t)) }, this.newSession = function () { this.conversationArea.innerHTML = "", this.element.querySelector(".chat-area-index").innerHTML = "", this.answerBubbles = this.element.querySelectorAll(".message-bubble.answer"), console.log("ChatArea ".concat(this.id, ": Started new session.")) } } }, 190: (t, e, n) => { function i(t) { return function (t) { if (Array.isArray(t)) return o(t) }(t) || function (t) { if ("undefined" != typeof Symbol && null != t[Symbol.iterator] || null != t["@@iterator"]) return Array.from(t) }(t) || function (t, e) { if (t) { if ("string" == typeof t) return o(t, e); var n = {}.toString.call(t).slice(8, -1); return "Object" === n && t.constructor && (n = t.constructor.name), "Map" === n || "Set" === n ? Array.from(t) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? o(t, e) : void 0 } }(t) || function () { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.") }() } function o(t, e) { (null == e || e > t.length) && (e = t.length); for (var n = 0, i = Array(e); n < e; n++)i[n] = t[n]; return i } var r = n(89), s = n(825), a = n(540); t.exports = function (t, e, n, o) { var c = this; this.receiverId = t, this.message = e, this.config = n, this.i18n = o, this.util = new s, this.chatAreas = new Map, this.driverFactory = new a, this.selectedProviders = new Map, this.element = null, this.chatAreaContainer = null, this.layoutSwitcher = null, this.eventHandlers = { onEvtAllWebAccessChanged: function (t) { c.chatAreas.forEach(function (e) { return e.setWebAccess(t) }) }, onEvtAllLongThoughtChanged: function (t) { c.chatAreas.forEach(function (e) { return e.setLongThought(t) }) }, onEvtAllPrompt: function (t) { c.message.send("chat", { prompt: t }) } }, this.setEventHandler = function (t, e) { this.eventHandlers[t] = e }, this.switchLanguage = function (t, e) { var n = this; (arguments.length > 2 && void 0 !== arguments[2] && arguments[2] || this.i18n.getCurrentLang() !== t) && (this.i18n.setCurrentLang(t), (e || this.element).querySelectorAll("[data-lang-key]").forEach(function (t) { var e = t.dataset.langKey, i = n.i18n.getText(e); "TEXTAREA" === t.tagName || "INPUT" === t.tagName ? t.placeholder = i : t.hasAttribute("title") ? t.title = i : t.textContent = i }), this.langDropdown.style.display = "none") }, this.init = function () { this.cacheDOMElements(), this.initEventListeners(), this.initMessageListeners(), this.updateLayout(), this.updateNewChatButtonState(), this.switchLanguage(this.i18n.getCurrentLang(), this.element, !0) }, this.cacheDOMElements = function () { this.element = document.querySelector(".main-window"), this.chatAreaContainer = this.element.querySelector(".content-area"), this.layoutSwitcher = this.element.querySelector("#layout-switcher"), this.globalSendButton = document.getElementById("global-send-button"), this.promptTextarea = document.getElementById("prompt-textarea"), this.promptWrapper = document.getElementById("prompt-wrapper"), this.langSwitcher = document.getElementById("lang-switcher"), this.langDropdown = document.getElementById("lang-dropdown"), this.settingsButton = document.getElementById("settings-button"), this.settingsMenu = document.getElementById("settings-menu"), this.newChatButton = document.getElementById("new-chat-button") }, this.initEventListeners = function () { var t = this; this.layoutSwitcher.addEventListener("click", function (e) { e.target.matches(".layout-button") && t.setLayout(e.target.dataset.layout) }), this.globalSendButton.addEventListener("click", function () { var e = t.promptTextarea.value; e.trim() && (t.eventHandlers.onEvtAllPrompt(e), t.promptTextarea.value = "", t.promptWrapper.dataset.replicatedValue = "") }), this.element.querySelector(".title-action-button").addEventListener("click", function () { window.close() }), this.langSwitcher.addEventListener("click", function (e) { e.stopPropagation(), t.langDropdown.style.display = "block" === t.langDropdown.style.display ? "none" : "block" }), this.langDropdown.addEventListener("click", function (e) { e.target.matches("[data-lang]") && t.switchLanguage(e.target.dataset.lang, t.element, !1) }), this.settingsButton.addEventListener("click", function (e) { e.stopPropagation(), t.settingsMenu.style.display = "block" === t.settingsMenu.style.display ? "none" : "block" }), this.settingsMenu.addEventListener("click", function (t) { return t.stopPropagation() }), this.settingsMenu.querySelector("#web-access").addEventListener("change", function (e) { t.eventHandlers.onEvtAllWebAccessChanged(e.target.checked) }), this.settingsMenu.querySelector("#long-thought").addEventListener("change", function (e) { t.eventHandlers.onEvtAllLongThoughtChanged(e.target.checked) }), this.closeAllDropdowns = function () { this.chatAreas.forEach(function (t) { return t.closeDropdowns() }) }, document.addEventListener("click", function (e) { t.langDropdown && (t.langDropdown.style.display = "none"), t.settingsMenu && (t.settingsMenu.style.display = "none"), e.target.closest(".model-selector") || e.target.closest(".params-selector") || t.closeAllDropdowns() }), this.promptTextarea.addEventListener("input", function () { t.promptWrapper.dataset.replicatedValue = t.promptTextarea.value }), this.newChatButton.addEventListener("click", function () { var e = "chat-area-".concat(Date.now()), n = t.settingsMenu.querySelector("#web-access").checked, i = t.settingsMenu.querySelector("#long-thought").checked; t.addChatArea({ id: e, url: null, providerName: "New Chat", params: { webAccess: n, longThought: i } }) }); var e = this.i18n.getAllLangs(); this.langDropdown.innerHTML = e.map(function (t) { return '<div data-lang="'.concat(t, '">').concat(t, "</div>") }).join("") }, this.setLayout = function (t) { if (t > 4 ? t = "6" : t > 2 ? t = "4" : t > 1 ? t = "2" : t < 1 && (t = "1"), this.chatAreaContainer.dataset.layout !== t) { this.chatAreaContainer.dataset.layout = t; var e = this.layoutSwitcher.querySelector(".active"); e && e.classList.remove("active"); var n = this.layoutSwitcher.querySelector('[data-layout="'.concat(t, '"]')); n && n.classList.add("active"), this.updateLayout(), this.updateNewChatButtonState() } }, this.updateNewChatButtonState = function () { var t = parseInt(this.chatAreaContainer.dataset.layout, 10), e = this.chatAreas.size; this.newChatButton.disabled = e >= t }, this.updateLayout = function () { var t = parseInt(this.chatAreaContainer.dataset.layout, 10), e = Array.from(this.chatAreas.values()), n = e.filter(function (t) { return t.isPinned() }), o = e.filter(function (t) { return !t.isPinned() }), r = [].concat(i(n), i(o)); e.forEach(function (t) { t.container.parentElement && (t.container.parentElement.style.display = "none") }); for (var s = 0; s < Math.min(t, r.length); s++)r[s].container.parentElement && (r[s].container.parentElement.style.display = "block") }, this.initMessageListeners = function () { this.message.register(this.receiverId, this) }, this.onMsgCreate = function (t) { this.addChatArea(t) }, this.onMsgAnswer = function (t) { var e = this.chatAreas.get(t.id); e && e.handleAnswer(t) }, this.onMsgDestroy = function (t) { this.removeChatArea(t.id) }, this.onMsgTitleChange = function (t) { var e = this.chatAreas.get(t.id); e && e.updateTitle(t.title) }, this.onMsgOptionChange = function (t) { var e = this.chatAreas.get(t.id); e && e.updateOption(t.key, t.value) }, this.onMsgQuestion = function (t) { var e = this.chatAreas.get(t.id); e && e.addQuestion(t.content) }, this.onMsgModelVersionChange = function (t) { var e = this.chatAreas.get(t.id); e && e.updateModelVersion(t.version) }, this.onMsgNewSession = function (t) { var e = this.chatAreas.get(t.id); e && e.newSession() }, this.addChatArea = function (t) { var e = this; if (this.chatAreas.has(t.id)) console.warn("ChatArea with id ".concat(t.id, " already exists.")); else { var n = this.util.toHtml({ tag: "div", "@class": "chat-area-wrapper" }), i = this.util.toHtml({ tag: "div", "@class": "chat-area-container" }); this.chatAreaContainer.appendChild(n), n.appendChild(i); var o = new r(this, t.id, t.url, i, this.i18n); o.init(t), this.switchLanguage(this.i18n.getCurrentLang(), o.element, !0), o.setEventHandler("onEvtNewSession", this._handleNewSession.bind(this)), o.setEventHandler("onEvtShare", this._handleShare.bind(this)), o.setEventHandler("onEvtParamChanged", this._handleParamChanged.bind(this)), o.setEventHandler("onEvtProviderChanged", function (t, n, i) { i && e.selectedProviders.get(i) === t.id && e.selectedProviders.delete(i), n && e.selectedProviders.set(n, t.id) }), o.setEventHandler("onEvtPromptSend", this._handlePromptSend.bind(this)), o.setEventHandler("onEvtExport", this._handleExport.bind(this)), this.chatAreas.set(t.id, o), this.updateDefaultLayout(), this.updateNewChatButtonState(), console.log("Added ChatArea: ".concat(t.id)), t.providerName && "New Chat" !== t.providerName && this.selectedProviders.set(t.providerName, t.id) } }, this.updateDefaultLayout = function () { var t = this.chatAreas.size, e = "1"; t > 4 ? e = "6" : t > 2 ? e = "4" : t > 1 && (e = "2"), this.setLayout(e) }, this.removeChatArea = function (t) { var e = this.chatAreas.get(t); if (e) { var n = e.getProvider(); n && this.selectedProviders.get(n) === t && this.selectedProviders.delete(n); var i = e.container.parentElement; e.destroy(), i && i.remove(), this.chatAreas.delete(t), this.updateDefaultLayout(), this.updateNewChatButtonState(), console.log("Removed ChatArea: ".concat(t)) } }, this._handleNewSession = function (t, e) { this.message.send(t.id, "new_session", { providerName: e }) }, this._handleShare = function (t, e) { navigator.clipboard.writeText(e), this.message.send(t.id, "focus", {}) }, this._handleParamChanged = function (t, e, n, i) { this.message.send(t.id, "param_changed", { key: e, newValue: n, oldValue: i }) }, this._handleProviderChanged = function (t, e, n) { var i = this.driverFactory.getProviderUrl(e); this.message.send(t.id, "change_provider", { url: i }), t.url = i }, this._handlePromptSend = function (t, e) { this.message.send(t.id, "prompt", { text: e }) }, this._handleExport = function (t) { this.message.send(t.id, "export", {}) }, this.getUnavailableProviders = function (t) { var e = []; return this.selectedProviders.forEach(function (n, i) { n !== t && e.push(i) }), e } } }, 385: t => { t.exports = { en: { "app.title": "Multi-AI Sync Chat", "button.send": "Send", "button.send.title": "Send", "prompt.placeholder": "Ask all AIs...", productName: "Multi AI Chat", newChatButtonTitle: "New Chat", settingsButtonTitle: "Settings", webAccessLabel: "Web Access", longThoughtLabel: "Long Thought", promptTextareaPlaceholder: "Ask all AIs...", globalSendButtonTitle: "Send", newSessionButtonTitle: "New Session", expandAllButtonTitle: "Expand All", collapseAllButtonTitle: "Collapse All", exportContentButtonTitle: "Export Content", parametersButtonTitle: "Parameters", modelVersionLabel: "Model Version", shareButtonTitle: "Share", pinButtonTitle: "Pin", closeButtonTitle: "Close", inputPlaceholder: "Input", typeMessagePlaceholder: "Type your message...", sendButtonTitle: "Send", selectProviderHint: "Please select an AI provider from the dropdown above to start chatting.", providerUnavailable: "This AI provider is already selected by another chat area." }, zh: { "app.title": "多AI同步聊天", "button.send": "发送", "button.send.title": "发送", "prompt.placeholder": "向所有AI提问...", productName: "多AI同步聊天", newChatButtonTitle: "新建聊天", settingsButtonTitle: "设置", webAccessLabel: "网页访问", longThoughtLabel: "长时思考", promptTextareaPlaceholder: "向所有AI提问...", globalSendButtonTitle: "发送", newSessionButtonTitle: "新会话", expandAllButtonTitle: "展开全部", collapseAllButtonTitle: "折叠全部", exportContentButtonTitle: "导出内容", parametersButtonTitle: "参数", modelVersionLabel: "模型版本", shareButtonTitle: "分享", pinButtonTitle: "固定", closeButtonTitle: "关闭", inputPlaceholder: "输入", typeMessagePlaceholder: "输入你的消息...", sendButtonTitle: "发送", selectProviderHint: "请从上方下拉菜单中选择一个AI提供商以开始聊天。", providerUnavailable: "该AI提供商已被其他聊天窗口选中。" }, ar: { "app.title": "دردشة متزامنة متعددة الذكاء الاصطناعي", "button.send": "إرسال", "button.send.title": "إرسال", "prompt.placeholder": "اسأل كل الذكاء الاصطناعي...", productName: "دردشة متزامنة متعددة الذكاء الاصطناعي", newChatButtonTitle: "محادثة جديدة", settingsButtonTitle: "الإعدادات", webAccessLabel: "الوصول إلى الويب", longThoughtLabel: "تفكير طويل", promptTextareaPlaceholder: "اسأل كل الذكاء الاصطناعي...", globalSendButtonTitle: "إرسال", newSessionButtonTitle: "جلسة جديدة", expandAllButtonTitle: "توسيع الكل", collapseAllButtonTitle: "طي الكل", exportContentButtonTitle: "تصدير المحتوى", parametersButtonTitle: "المعلمات", modelVersionLabel: "إصدار النموذج", shareButtonTitle: "مشاركة", pinButtonTitle: "تثبيت", closeButtonTitle: "إغلاق", inputPlaceholder: "إدخال", typeMessagePlaceholder: "اكتب رسالتك...", sendButtonTitle: "إرسال", selectProviderHint: "الرجاء تحديد مزود الذكاء الاصطناعي من القائمة المنسدلة أعلاه لبدء الدردشة.", providerUnavailable: "لقد تم اختيار مزود الذكاء الاصطناعي هذا بواسطة منطقة دردشة أخرى." } } }, 540: (t, e, n) => { var i = n(981), o = i.KimiPageDriver, r = i.GeminiPageDriver, s = i.ChatGPTPageDriver, a = i.GenericPageDriver; t.exports = function () { var t = { "kimi.ai": { name: "Kimi", url: "https://www.kimi.com" }, "www.kimi.com": { name: "Kimi", url: "https://www.kimi.com" }, "gemini.google.com": { name: "Gemini", url: "https://gemini.google.com/app" }, "chat.openai.com": { name: "ChatGPT", url: "https://chat.openai.com" } }, e = { Kimi: o, Gemini: r, ChatGPT: s }; this.getProviders = function () { return Object.keys(e) }, this.getProviderUrl = function (e) { var n; return (null === (n = Object.values(t).find(function (t) { return t.name === e })) || void 0 === n ? void 0 : n.url) || "" }, this.createDriver = function (n) { var i = t[n]; if (i) { var o = e[i.name]; if (o) return new o } return console.warn("No specific driver found for ".concat(n, ". Using GenericPageDriver.")), new a } } }, 677: (t, e, n) => { n(27); t.exports = function (t, e) { if (!t) throw new Error("Config instance must be provided to I18n."); this.config = t, this.resources = e || {}, this.currentLang = "en", this.init = function () { var t = this.config.get("current-lang"), e = this.getBrowserLang(); this.currentLang = t || e || "en" }, this.getText = function (t) { var e = this.currentLang; if (this.resources[e] && void 0 !== this.resources[e][t]) return this.resources[e][t]; var n = e.split("-")[0]; return this.resources[n] && void 0 !== this.resources[n][t] ? this.resources[n][t] : this.resources.en && void 0 !== this.resources.en[t] ? this.resources.en[t] : t }, this.getCurrentLang = function () { return this.currentLang }, this.setCurrentLang = function (t) { this.currentLang = t, this.config.set("current-lang", t) }, this.getBrowserLang = function () { return navigator.language || navigator.userLanguage || null }, this.getAllLangs = function () { return Object.keys(this.resources) }, this.init() } }, 825: t => { var e = ["tag", "text", "innerHTML", "children", "child"]; function n() { var t, e, o = "function" == typeof Symbol ? Symbol : {}, r = o.iterator || "@@iterator", s = o.toStringTag || "@@toStringTag"; function a(n, o, r, s) { var a = o && o.prototype instanceof l ? o : l, u = Object.create(a.prototype); return i(u, "_invoke", function (n, i, o) { var r, s, a, l = 0, u = o || [], h = !1, d = { p: 0, n: 0, v: t, a: p, f: p.bind(t, 4), d: function (e, n) { return r = e, s = 0, a = t, d.n = n, c } }; function p(n, i) { for (s = n, a = i, e = 0; !h && l && !o && e < u.length; e++) { var o, r = u[e], p = d.p, v = r[2]; n > 3 ? (o = v === i) && (a = r[(s = r[4]) ? 5 : (s = 3, 3)], r[4] = r[5] = t) : r[0] <= p && ((o = n < 2 && p < r[1]) ? (s = 0, d.v = i, d.n = r[1]) : p < v && (o = n < 3 || r[0] > i || i > v) && (r[4] = n, r[5] = i, d.n = v, s = 0)) } if (o || n > 1) return c; throw h = !0, i } return function (o, u, v) { if (l > 1) throw TypeError("Generator is already running"); for (h && 1 === u && p(u, v), s = u, a = v; (e = s < 2 ? t : a) || !h;) { r || (s ? s < 3 ? (s > 1 && (d.n = -1), p(s, a)) : d.n = a : d.v = a); try { if (l = 2, r) { if (s || (o = "next"), e = r[o]) { if (!(e = e.call(r, a))) throw TypeError("iterator result is not an object"); if (!e.done) return e; a = e.value, s < 2 && (s = 0) } else 1 === s && (e = r.return) && e.call(r), s < 2 && (a = TypeError("The iterator does not provide a '" + o + "' method"), s = 1); r = t } else if ((e = (h = d.n < 0) ? a : n.call(i, d)) !== c) break } catch (e) { r = t, s = 1, a = e } finally { l = 1 } } return { value: e, done: h } } }(n, r, s), !0), u } var c = {}; function l() { } function u() { } function h() { } e = Object.getPrototypeOf; var d = [][r] ? e(e([][r]())) : (i(e = {}, r, function () { return this }), e), p = h.prototype = l.prototype = Object.create(d); function v(t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, h) : (t.__proto__ = h, i(t, s, "GeneratorFunction")), t.prototype = Object.create(p), t } return u.prototype = h, i(p, "constructor", h), i(h, "constructor", u), u.displayName = "GeneratorFunction", i(h, s, "GeneratorFunction"), i(p), i(p, s, "Generator"), i(p, r, function () { return this }), i(p, "toString", function () { return "[object Generator]" }), (n = function () { return { w: a, m: v } })() } function i(t, e, n, o) { var r = Object.defineProperty; try { r({}, "", {}) } catch (t) { r = 0 } i = function (t, e, n, o) { if (e) r ? r(t, e, { value: n, enumerable: !o, configurable: !o, writable: !o }) : t[e] = n; else { var s = function (e, n) { i(t, e, function (t) { return this._invoke(e, n, t) }) }; s("next", 0), s("throw", 1), s("return", 2) } }, i(t, e, n, o) } function o(t, e, n, i, o, r, s) { try { var a = t[r](s), c = a.value } catch (t) { return void n(t) } a.done ? e(c) : Promise.resolve(c).then(i, o) } function r(t, e) { return function (t) { if (Array.isArray(t)) return t }(t) || function (t, e) { var n = null == t ? null : "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"]; if (null != n) { var i, o, r, s, a = [], c = !0, l = !1; try { if (r = (n = n.call(t)).next, 0 === e) { if (Object(n) !== n) return; c = !1 } else for (; !(c = (i = r.call(n)).done) && (a.push(i.value), a.length !== e); c = !0); } catch (t) { l = !0, o = t } finally { try { if (!c && null != n.return && (s = n.return(), Object(s) !== s)) return } finally { if (l) throw o } } return a } }(t, e) || function (t, e) { if (t) { if ("string" == typeof t) return s(t, e); var n = {}.toString.call(t).slice(8, -1); return "Object" === n && t.constructor && (n = t.constructor.name), "Map" === n || "Set" === n ? Array.from(t) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? s(t, e) : void 0 } }(t, e) || function () { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.") }() } function s(t, e) { (null == e || e > t.length) && (e = t.length); for (var n = 0, i = Array(e); n < e; n++)i[n] = t[n]; return i } function a(t) { return a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t }, a(t) } t.exports = function () { this.documentReady = function (t) { var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 5e3; "complete" === document.readyState ? setTimeout(t, e) : window.addEventListener("load", function () { setTimeout(t, e) }) }, this.toHtml = function t(n) { if ("string" == typeof n) return document.createTextNode(n); var i = n.tag, o = n.text, s = n.innerHTML, c = n.children, l = n.child, u = function (t, e) { if (null == t) return {}; var n, i, o = function (t, e) { if (null == t) return {}; var n = {}; for (var i in t) if ({}.hasOwnProperty.call(t, i)) { if (-1 !== e.indexOf(i)) continue; n[i] = t[i] } return n }(t, e); if (Object.getOwnPropertySymbols) { var r = Object.getOwnPropertySymbols(t); for (i = 0; i < r.length; i++)n = r[i], -1 === e.indexOf(n) && {}.propertyIsEnumerable.call(t, n) && (o[n] = t[n]) } return o }(n, e); if (!i) { var h = Object.keys(n)[0]; if (h && !["@", "on", "text", "innerHTML", "children", "child"].some(function (t) { return h.startsWith(t) }) && (o = n[i = h], delete u[i], c || l)) throw new Error("Shorthand tag format cannot have children.") } if (!i) throw new Error('JSON object must have a "tag" property or a shorthand tag.'); var d = document.createElement(i); for (var p in s ? d.innerHTML = s : o && ("script" === i.toLowerCase() && "function" == typeof o ? d.textContent = o.toString() : d.textContent = o), u) if (p.startsWith("@")) { var v = p.substring(1), m = u[p]; "object" === a(m) && null !== m && (m = Object.entries(m).map(function (t) { var e = r(t, 2), n = e[0], i = e[1]; return "".concat(n, ":").concat(i) }).join(";")), d.setAttribute(v, m) } else if (p.startsWith("on")) { var g = p.toLowerCase(), f = u[p]; "function" == typeof f && (f = "(".concat(f.toString(), ")()")), d.setAttribute(g, f) } var b = c || l; return b && (Array.isArray(b) ? b.forEach(function (e) { d.appendChild(t(e)) }) : d.appendChild(t(b))), d }, this.$ = function (t) { var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : document; return null == t || "" === t ? null : e.querySelector(t) }, this.$ = function (t) { var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : document; return null == t || "" === t ? [] : e.querySelectorAll(t) }, this.clickAndGet = function () { var t, e = (t = n().m(function t(e, i) { var o; return n().w(function (t) { for (; ;)switch (t.n) { case 0: return e.click(), t.n = 1, new Promise(function (t) { return setTimeout(t, 200) }); case 1: return o = i(), e.click(), t.a(2, o) } }, t) }), function () { var e = this, n = arguments; return new Promise(function (i, r) { var s = t.apply(e, n); function a(t) { o(s, i, r, a, c, "next", t) } function c(t) { o(s, i, r, a, c, "throw", t) } a(void 0) }) }); return function (t, n) { return e.apply(this, arguments) } }(), this.getText = function (t) { if (t) { var e = t.tagName.toLowerCase(), n = t.type ? t.type.toLowerCase() : ""; return "input" === e ? "checkbox" === n || "radio" === n ? t.checked : t.value : "textarea" === e || "select" === e ? t.value : t.textContent } }, this.setText = function (t, e) { if (t) { var n = t.tagName.toLowerCase(), i = t.type ? t.type.toLowerCase() : ""; "input" === n ? "checkbox" === i || "radio" === i ? t.checked = !!e : t.value = String(e) : "textarea" === n || "select" === n ? t.value = String(e) : t.textContent = String(e) } }, this.getBoolean = function (t) { if (t) { var e = t.tagName.toLowerCase(), n = t.type ? t.type.toLowerCase() : ""; return "input" !== e || "checkbox" !== n && "radio" !== n ? void 0 : t.checked } }, this.getFunctionName = function (t) { return "function" != typeof t ? null : t.name || t.toString().match(/function ([^\(]+)/)[1] }, this.escapeHtml = function (t) { return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;") }, this.safeJsonString = function (t) { return JSON.stringify(t).replace(/</g, "\\u003c").replace(/>/g, "\\u003e").replace(/&/g, "\\u0026").replace(/'/g, "\\u0027") }, this.safeString = function (t) { return t.replace(/\\/g, "\\\\").replace(/'/g, "\\'").replace(/`/g, "'").replace(/\n/g, "\\n").replace(/\r/g, "\\r").replace(/\t/g, "\\t") } } }, 866: t => { t.exports = function (t) { if (!t) throw new Error("channelName is required for Message module."); this.channel = new BroadcastChannel(t), this.listeners = new Map, this.handleMessage = function (t) { var e = t.data, n = e.type, i = e.data; if (n) { var o = i ? i.receiverId : void 0; if (o) { var r = this.listeners.get(o); if (r) { var s = r.get(n); s && s.forEach(function (t) { try { t(i) } catch (t) { console.error("Error in message handler for type '".concat(n, "' and receiverId '").concat(o, "':"), t) } }) } } else this.listeners.forEach(function (t) { var e = t.get(n); e && e.forEach(function (t) { try { t(i) } catch (t) { console.error("Error in broadcast message handler for type '".concat(n, "':"), t) } }) }) } }, this.handleMessage = this.handleMessage.bind(this), this.channel.addEventListener("message", this.handleMessage), this.send = function (t, e) { try { this.channel.postMessage({ type: t, data: e }) } catch (t) { console.error("Error posting message: ".concat(t)) } }, this.register = function (t, e) { if (t && e) { this.listeners.has(t) || this.listeners.set(t, new Map); var n = this.listeners.get(t); for (var i in e) if ("function" == typeof e[i] && i.startsWith("onMsg")) { var o = i.substring(5).charAt(0).toLowerCase() + i.substring(6); n.has(o) || n.set(o, new Set), n.get(o).add(e[i].bind(e)) } } else console.warn("Message.register: receiverId and listener are required.") }, this.unregister = function (t) { t && this.listeners.delete(t) }, this.close = function () { this.channel.removeEventListener("message", this.handleMessage), this.channel.close(), this.listeners.clear() } } }, 892: t => { t.exports = function () { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "multi-ai-chat-"; this.set = function (e, n) { var i = t + e; try { var o = JSON.stringify(n); localStorage.setItem(i, o) } catch (t) { console.error("Error saving to localStorage: ".concat(t)) } }, this.get = function (e) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, i = t + e; try { var o = localStorage.getItem(i); return null === o ? n : JSON.parse(o) } catch (t) { return console.error("Error reading from localStorage: ".concat(t)), n } }, this.remove = function (e) { var n = t + e; try { localStorage.removeItem(n) } catch (t) { console.error("Error removing from localStorage: ".concat(t)) } } } }, 981: (t, e, n) => { function i() { var t, e, n = "function" == typeof Symbol ? Symbol : {}, r = n.iterator || "@@iterator", s = n.toStringTag || "@@toStringTag"; function a(n, i, r, s) { var a = i && i.prototype instanceof l ? i : l, u = Object.create(a.prototype); return o(u, "_invoke", function (n, i, o) { var r, s, a, l = 0, u = o || [], h = !1, d = { p: 0, n: 0, v: t, a: p, f: p.bind(t, 4), d: function (e, n) { return r = e, s = 0, a = t, d.n = n, c } }; function p(n, i) { for (s = n, a = i, e = 0; !h && l && !o && e < u.length; e++) { var o, r = u[e], p = d.p, v = r[2]; n > 3 ? (o = v === i) && (a = r[(s = r[4]) ? 5 : (s = 3, 3)], r[4] = r[5] = t) : r[0] <= p && ((o = n < 2 && p < r[1]) ? (s = 0, d.v = i, d.n = r[1]) : p < v && (o = n < 3 || r[0] > i || i > v) && (r[4] = n, r[5] = i, d.n = v, s = 0)) } if (o || n > 1) return c; throw h = !0, i } return function (o, u, v) { if (l > 1) throw TypeError("Generator is already running"); for (h && 1 === u && p(u, v), s = u, a = v; (e = s < 2 ? t : a) || !h;) { r || (s ? s < 3 ? (s > 1 && (d.n = -1), p(s, a)) : d.n = a : d.v = a); try { if (l = 2, r) { if (s || (o = "next"), e = r[o]) { if (!(e = e.call(r, a))) throw TypeError("iterator result is not an object"); if (!e.done) return e; a = e.value, s < 2 && (s = 0) } else 1 === s && (e = r.return) && e.call(r), s < 2 && (a = TypeError("The iterator does not provide a '" + o + "' method"), s = 1); r = t } else if ((e = (h = d.n < 0) ? a : n.call(i, d)) !== c) break } catch (e) { r = t, s = 1, a = e } finally { l = 1 } } return { value: e, done: h } } }(n, r, s), !0), u } var c = {}; function l() { } function u() { } function h() { } e = Object.getPrototypeOf; var d = [][r] ? e(e([][r]())) : (o(e = {}, r, function () { return this }), e), p = h.prototype = l.prototype = Object.create(d); function v(t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, h) : (t.__proto__ = h, o(t, s, "GeneratorFunction")), t.prototype = Object.create(p), t } return u.prototype = h, o(p, "constructor", h), o(h, "constructor", u), u.displayName = "GeneratorFunction", o(h, s, "GeneratorFunction"), o(p), o(p, s, "Generator"), o(p, r, function () { return this }), o(p, "toString", function () { return "[object Generator]" }), (i = function () { return { w: a, m: v } })() } function o(t, e, n, i) { var r = Object.defineProperty; try { r({}, "", {}) } catch (t) { r = 0 } o = function (t, e, n, i) { if (e) r ? r(t, e, { value: n, enumerable: !i, configurable: !i, writable: !i }) : t[e] = n; else { var s = function (e, n) { o(t, e, function (t) { return this._invoke(e, n, t) }) }; s("next", 0), s("throw", 1), s("return", 2) } }, o(t, e, n, i) } function r(t, e, n, i, o, r, s) { try { var a = t[r](s), c = a.value } catch (t) { return void n(t) } a.done ? e(c) : Promise.resolve(c).then(i, o) } function s(t) { return function () { var e = this, n = arguments; return new Promise(function (i, o) { var s = t.apply(e, n); function a(t) { r(s, i, o, a, c, "next", t) } function c(t) { r(s, i, o, a, c, "throw", t) } a(void 0) }) } } var a = n(825); function c() { this.util = new a, this.selectors = { promptInput: "textarea", sendButton: 'button[type="submit"]', questions: ".question", answers: ".answer", conversationArea: "#conversation", chatTitle: "h1", historyItems: ".history-item", answerCollapsedClass: "collapsed", newSessionButton: "button.new-session", webAccessOption: "input#web-access", longThoughtOption: "input#long-thought", modelVersionList: "select.model-version", currentModelVersion: "span.current-model" }, this.onAnswer = function (t, e) { }, this.onChatTitle = function (t) { }, this.onOption = function (t, e) { }, this.onQuestion = function (t, e) { }, this.onModelVersionChange = function (t) { }, this.onNewSession = function () { }, this.className = this.util.getFunctionName(this), this.observer = null, this.currentModelVersionObserver = null, this.optionObservers = [], this.newSessionButtonListener = null, this.init = s(i().m(function t() { return i().w(function (t) { for (; ;)if (0 === t.n) return t.a(2) }, t) })), this.elementPromptInput = function () { return this.util.$(this.selectors.promptInput) }, this.elementSendButton = function () { return this.util.$(this.selectors.sendButton) }, this.elementConversationArea = function () { return this.util.$(this.selectors.conversationArea) }, this.elementHistoryArea = function () { return this.util.$(this.selectors.historyArea) }, this.elementQuestions = function () { return this.util.$(this.selectors.questions) }, this.elementAnswers = function () { return this.util.$(this.selectors.answers) }, this.elementHistoryItems = function () { return this.util.$(this.selectors.historyItems) }, this.elementQuestion = function (t) { return this.elementQuestions()[t] || null }, this.elementAnswer = function (t) { return this.elementAnswers()[t] || null }, this.elementChatTitle = function () { return this.util.$(this.selectors.chatTitle) }, this.elementHistoryItem = function (t) { return this.elementHistoryItems()[t] || null }, this.elementNewSessionButton = function () { return this.util.$(this.selectors.newSessionButton) }, this.elementWebAccessOption = function () { return this.util.$(this.selectors.webAccessOption) }, this.elementLongThoughtOption = function () { return this.util.$(this.selectors.longThoughtOption) }, this.elementModelVersionList = function () { return this.util.$(this.selectors.modelVersionList) }, this.elementCurrentModelVersion = function () { return this.util.$(this.selectors.currentModelVersion) }, this.getPromptInput = function () { return this.util.getText(this.elementPromptInput()) }, this.getConversationCount = function () { return this.elementQuestions().length }, this.getHistoryCount = function () { return this.elementHistoryItems().length }, this.getHistory = function (t) { var e = this.elementHistoryItem(t); return e ? { title: e.textContent.trim(), url: e.href } : null }, this.getQuestion = function (t) { var e = this.elementQuestion(t); return e ? e.textContent.trim() : "" }, this.getAnswer = function (t) { var e = this.elementAnswer(t); return e ? e.textContent.trim() : "" }, this.getWebAccessOption = function () { var t = this.elementWebAccessOption(); return this.util.getBoolean(t) }, this.getLongThoughtOption = function () { var t = this.elementLongThoughtOption(); return this.util.getBoolean(t) }, this.getModelVersionList = function () { return Array.from(this.elementModelVersionList(), function (t) { return t.textContent }) }, this.getCurrentModelVersion = function () { return this.util.getText(this.elementCurrentModelVersion()) }, this.getChatTitle = function () { var t = this.elementChatTitle(); return this.util.getText(t, "") }, this.getOptions = function () { return { webAccess: this.getWebAccessOption(), longThought: this.getLongThoughtOption() } }, this.getAnswerStatus = function (t) { var e = this.elementAnswer(t); return !!e && e.classList.contains(this.selectors.answerCollapsedClass) }, this.setPrompt = function (t) { var e = this.util.$(this.selectors.promptInput); e ? (e.value = t, e.dispatchEvent(new Event("input", { bubbles: !0 }))) : console.error("Prompt input not found") }, this.send = function () { if ("" !== this.selectors.sendButton) { var t = this.util.$(this.selectors.sendButton); t ? t.click() : console.error("Send button not found") } else { var e = this.elementPromptInput(); if (e) { var n = new KeyboardEvent("keydown", { bubbles: !0, cancelable: !0, key: "Enter", code: "Enter", keyCode: 13 }); e.dispatchEvent(n) } else console.error("Prompt input not found for Enter key simulation.") } }, this.addAttachment = function (t) { console.warn("addAttachment() is not implemented. This may be restricted by browser security.") }, this.setOption = function (t, e) { console.warn("setOption() is not implemented in the generic driver.") }, this.setAnswerStatus = function (t, e) { var n = this.elementAnswer(t); n && this.selectors.answerCollapsedClass && (e ? n.classList.add(this.selectors.answerCollapsedClass) : n.classList.remove(this.selectors.answerCollapsedClass)) }, this.setModelVersion = function (t) { console.warn("setModelVersion() is not implemented in the generic driver. Attempted to set version: ".concat(t)) }, this.newSession = function () { console.warn("newSession() is not implemented in the generic driver.") }, this.startMonitoring = s(i().m(function t() { var e, n, o, r, s, a, c, l, u, h, d, p, v, m = this; return i().w(function (t) { for (; ;)switch (t.n) { case 0: e = this.getConversationCount(), n = this.elementAnswers().length, o = this.getChatTitle(), r = this.getCurrentModelVersion(), s = this.getWebAccessOption(), a = this.getLongThoughtOption(), this.observer = new MutationObserver(function (t) { t.forEach(function (t) { if ("childList" === t.type && t.addedNodes.length > 0) { var i = m.getConversationCount(); if (i > e) { var r = i - 1, s = m.elementQuestion(r); s && m.onQuestion(r, s), e = i } var a = m.elementAnswers().length; a > n && (t.addedNodes.forEach(function (t) { if (1 === t.nodeType && t.matches(m.selectors.answers)) { var e = Array.from(m.util.$(m.selectors.answers)).indexOf(t); m.onAnswer(e, t) } }), n = a) } var c = m.getChatTitle(); c !== o && (m.onChatTitle(c), o = c) }) }), (c = this.util.$(this.selectors.conversationArea)) ? this.observer.observe(c, { childList: !0, subtree: !0, attributes: !0, characterData: !0 }) : console.error("Conversation area not found for monitoring."), (l = this.elementCurrentModelVersion()) && (this.currentModelVersionObserver = new MutationObserver(function () { var t = m.getCurrentModelVersion(); t !== r && (m.onModelVersionChange(t), r = t) }), this.currentModelVersionObserver.observe(l, { childList: !0, subtree: !0, characterData: !0 })), (u = this.elementWebAccessOption()) && ((h = new MutationObserver(function () { var t = m.getWebAccessOption(); t !== s && (m.onOption("webAccess", t), s = t) })).observe(u, { attributes: !0, attributeFilter: ["checked"] }), this.optionObservers.push(h)), (d = this.elementLongThoughtOption()) && ((p = new MutationObserver(function () { var t = m.getLongThoughtOption(); t !== a && (m.onOption("longThought", t), a = t) })).observe(d, { attributes: !0, attributeFilter: ["checked"] }), this.optionObservers.push(p)), (v = this.elementNewSessionButton()) && (this.newSessionButtonListener = function () { return m.onNewSession() }, v.addEventListener("click", this.newSessionButtonListener)); case 1: return t.a(2) } }, t, this) })), this.stopMonitoring = function () { this.observer && this.observer.disconnect(), this.currentModelVersionObserver && this.currentModelVersionObserver.disconnect(), this.optionObservers.forEach(function (t) { return t.disconnect() }), this.newSessionButtonListener && this.elementNewSessionButton() && this.elementNewSessionButton().removeEventListener("click", this.newSessionButtonListener) } } t.exports = { GenericPageDriver: c, KimiPageDriver: function () { c.call(this), this.selectors = Object.assign({}, this.selectors, { promptInput: "div.chat-action > div.chat-editor > div.chat-input div.chat-input-editor", sendButton: "div.chat-action > div.chat-editor > div.chat-editor-action div.send-button-container > div.send-button", questions: "div.chat-content-item.chat-content-item-user div.segment-content div.segment-content-box", answers: "div.chat-content-item.chat-content-item-assistant div.segment-content div.segment-content-box", conversationArea: "#app div.main div.layout-content-main div.chat-content-container", chatTitle: "#app div.main div.layout-header header.chat-header-content h2", historyItems: ".sidebar div.history-part ul li", newSessionButton: "#app aside div.sidebar-nav a.new-chat-btn", webAccessOption: "body div.toolkit-popover > div.toolkit-container div.toolkit-item:nth-child(1) > div.search-switch > label > input", longThoughtOption: "body div.toolkit-popover > div.toolkit-container div.toolkit-item:nth-child(2) > div.search-switch > label > input", modelVersionList: "body div.models-popover div.models-container div.model-item div.model-name > span.name", currentModelVersion: "#app div.main div.chat-action > div.chat-editor > div.chat-editor-action div.current-model span.name", modelVersionButton: "div.current-model", optionButton: "div.toolkit-trigger-btn" }), this.optionButton = this.util.$(this.selectors.optionButton), this.modelVersionButton = this.util.$(this.selectors.modelVersionButton), this.cachedWebAccess = null, this.cachedLongThought = null, this.cachedVersions = null, this.init = s(i().m(function t() { var e = this; return i().w(function (t) { for (; ;)switch (t.n) { case 0: if (!this.optionButton) { t.n = 2; break } return t.n = 1, this.util.clickAndGet(this.optionButton, function () { e.cachedWebAccess = e.util.getBoolean(e.util.$(e.selectors.webAccessOption)), e.cachedLongThought = e.util.getBoolean(e.util.$(e.selectors.longThoughtOption)) }); case 1: this.optionButton.addEventListener("click", s(i().m(function t() { return i().w(function (t) { for (; ;)switch (t.n) { case 0: return t.n = 1, new Promise(function (t) { return setTimeout(t, 200) }); case 1: e.cachedWebAccess = e.util.getBoolean(e.util.$(e.selectors.webAccessOption)), e.cachedLongThought = e.util.getBoolean(e.util.$(e.selectors.longThoughtOption)); case 2: return t.a(2) } }, t) }))); case 2: if (!this.modelVersionButton) { t.n = 3; break } return t.n = 3, this.util.clickAndGet(this.modelVersionButton, function () { e.cachedVersions = Array.from(e.util.$(e.selectors.modelVersionList), function (t) { return t.textContent }) }); case 3: return t.a(2) } }, t, this) })), this.getWebAccessOption = function () { return null === this.cachedWebAccess && console.warn("KimiPageDriver not initialized. Call init() before using getters."), this.cachedWebAccess }, this.getLongThoughtOption = function () { return null === this.cachedLongThought && console.warn("KimiPageDriver not initialized. Call init() before using getters."), this.cachedLongThought }, this.getModelVersionList = function () { return null === this.cachedVersions && console.warn("KimiPageDriver not initialized. Call init() before using getters."), this.cachedVersions } }, GeminiPageDriver: function () { c.call(this), this.selectors = Object.assign({}, this.selectors, { promptInput: "input-container div.input-area rich-textarea", sendButton: "", questions: "div#chat-history div.conversation-container div.query-content", answers: "div#chat-history div.response-content message-content", conversationArea: "div#chat-history", chatTitle: "", historyItems: "div.conversation-title", newSessionButton: "side-nav-action-button button", webAccessOption: "", longThoughtOption: "", modelVersionList: "div.mat-mdc-menu-panel div.mat-mdc-menu-content > button.mat-mdc-menu-item span.mat-mdc-menu-item-text div.title-and-description > span.mode-desc.gds-label-m-alt", currentModelVersion: "bard-mode-switcher button.mdc-button > span.mdc-button__label > div > span", modelVersionButton: "bard-mode-switcher button.mdc-button", optionButton: "" }) }, ChatGPTPageDriver: function () { c.call(this), this.selectors = Object.assign({}, this.selectors, {}) } } } }, e = {}; function n(i) { var o = e[i]; if (void 0 !== o) return o.exports; var r = e[i] = { exports: {} }; return t[i](r, r.exports, n), r.exports } var i, o, r, s, a, c, l; i = n(825), o = n(892), r = n(27), s = n(677), a = n(866), n(540), n(89), c = n(190), l = n(385), function () { console.log("Main window initializer loading ..."), new i; var t = new o, e = new r(t, { channelName: "multi-ai-chat" }), n = new s(e, l), u = new a(e.get("channelName")); new c(window.mainWindowName, u, e, n).init(), console.log("Main window initializer loaded.") }(), MainWindowInitializer = {}.default })();
console.log('Main window initialized.');
