# æ€»ä½“æ¶æ„æè¿°

## ğŸ“‹ æ¦‚è¿°

- æœ¬æ–‡çš„æè¿°å†…å®¹å¿…é¡»éµå¾ªåŸºç¡€è§„åˆ™ [./GEMINI.md] çš„çº¦æŸã€‚
- æ‰€æœ‰çš„å…¶ä»–è®¾è®¡æ–‡æ¡£ï¼Œéƒ½ä¸èƒ½è¿èƒŒæœ¬æ–‡çš„æ€»ä½“æ¶æ„è®¾è®¡ï¼Œé™¤éç‰¹åˆ«æŒ‡å‡ºã€‚
- æœ¬æ–‡çš„è¿˜å¯ä»¥çš„æ˜¯æ‰€æœ‰æ¨¡å—éƒ½å¿…é¡»éµå®ˆçš„åŸåˆ™ã€æŠ€æœ¯ã€æ¥å£æˆ–è€…ç›¸å…³è§„èŒƒã€‚

### åè¯å®šä¹‰

- aiå¯¹è¯é¡µé¢ï¼šä¹Ÿå«åšåŸç”Ÿé¡µé¢ï¼Œæ˜¯æµè§ˆå™¨ä¸­è¾“å…¥urlè®¿é—®åˆ°çš„aiæœåŠ¡æä¾›å•†çš„å¯¹è¯é¡µé¢
- aiä¼šè¯ï¼šåœ¨aiå¯¹è¯é¡µé¢ä¸­ä¸€è½®è·Ÿç‰¹å®šä¸»é¢˜ç›¸å…³çš„å¤šæ¬¡äººæœºå¯¹è¯çš„æ‰€æœ‰é—®ç­”å†…å®¹
- ä¸»çª—å£ï¼šåŒ…å«å¤šä¸ªå†…å®¹å—çš„æ–°é¡µé¢ï¼Œè¯¥çª—å£åå­—ä¸ºmulti-ai-sync-chat-window
- å†…å®¹å—ï¼šä¹Ÿå«chatareaï¼Œå¯¹åº”ä¸€ä¸ªaiä¼šè¯ï¼ŒåŒ…å«ä¸€äº›æ§åˆ¶éƒ¨ä»¶

## **æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡åŸåˆ™**

- **æ¶æ„æ¨¡å¼**:
  - **ä¸»ä»åˆ†ç¦»æ¶æ„**:
    - **åŸç”Ÿé¡µé¢ (ä»)**: ä½œä¸ºâ€œä»å±â€é¡µé¢ï¼Œä»…æ³¨å…¥ä¸€ä¸ªâ€œåŒæ­¥å¯¹æ¯”â€æŒ‰é’®å’Œè½»é‡çº§çš„é©±åŠ¨è„šæœ¬ã€‚è´Ÿè´£ç›‘å¬ DOM å˜åŒ–ã€ä¸ä¸»çª—å£é€šä¿¡ã€‚
    - **ä¸»çª—å£ (ä¸»)**: ä½œä¸ºâ€œä¸»æ§â€ä¸­å¿ƒï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æµè§ˆå™¨ Tabã€‚è´Ÿè´£ç®¡ç†å¸ƒå±€ã€æ±‡æ€»å±•ç¤ºæ‰€æœ‰ AI çš„å¯¹è¯å†…å®¹ã€å¹¶å°†ç”¨æˆ·è¾“å…¥åˆ†å‘åˆ°å„ä¸ªåŸç”Ÿé¡µé¢ã€‚
  - **é©±åŠ¨æ¨¡å¼ (Driver Pattern)**: ä¸ºæ¯ä¸ªæ”¯æŒçš„ AI ç½‘ç«™ç¼–å†™ä¸€ä¸ªç‹¬ç«‹çš„ `PageDriver`ï¼ˆå¦‚ `KimiPageDriver`, `GeminiPageDriver`ï¼‰ã€‚è¿™äº›é©±åŠ¨ç»§æ‰¿è‡ªä¸€ä¸ªé€šç”¨çš„ `GenericPageDriver`ï¼Œå°è£…äº†ä¸ç‰¹å®šç½‘ç«™ DOM äº¤äº’çš„ç»†èŠ‚ï¼ˆå¦‚å®šä½è¾“å…¥æ¡†ã€è·å–å›ç­”å†…å®¹ï¼‰ã€‚

### å…³é”®çº¦æŸ

- åŸç”Ÿé¡µé¢åªæ³¨å…¥â€œåŒæ­¥å¯¹æ¯”â€æŒ‰é’®ï¼Œå…¶ä½™é€»è¾‘é€šè¿‡ MessageNotifierï¼ˆBroadcastChannel + postMessageï¼‰ä¸ä¸»çª—å£é€šè®¯ã€‚
- ä¸»çª—å£ä¸ºç‹¬ç«‹ tabï¼Œå¯ 1/2/3/4/6 åˆ†æ å¸ƒå±€ï¼›æ¯æ å¯¹åº”ä¸€å®¶ AIï¼Œæ å†…æ”¯æŒåˆ‡æ¢ AIã€å¤åˆ¶ã€æŠ˜å ã€åˆ†äº«ã€æ–°å»ºä¼šè¯ã€è¾“å…¥å¯¹è¯ã€‚
- é»˜è®¤æ”¯æŒ 8 ç§è¯­è¨€ï¼ŒUI æ–‡æ¡ˆå…¨éƒ¨ç”¨ key å¼•ç”¨ï¼Œi18n è¡¨æ”¾é™„å½•ã€‚

### ä¸»å¹²æµç¨‹

#### é˜¶æ®µ 1ï¼šè„šæœ¬å¯åŠ¨

1. å»¶è¿Ÿ 3 ç§’ â†’ æ£€æµ‹å½“å‰ URL â†’ åŒ¹é… AIä¾›åº”å•†é©±åŠ¨ï¼ˆé™„å½• Bï¼‰ â†’ æ³¨å…¥æŒ‰é’® â€œåŒæ­¥å¯¹æ¯”â€
2. åˆ©ç”¨AIä¾›åº”å•†é©±åŠ¨å¯¹åŸç”Ÿé¡µé¢çš„å¯¹è¯å†…å®¹è¿›è¡Œä¿®é¥°ï¼Œä¸ºæ¯æ¡ AI å›ç­”è¿½åŠ æ‚¬æµ®å·¥å…·æ ï¼ˆå¤åˆ¶ / æŠ˜å  / éšè— / åˆ†äº«ï¼‰ã€‚
3. æŒ‰é’®ç‚¹å‡» â†’ è‹¥ä¸»çª—å£ä¸å­˜åœ¨åˆ™ window.open('multi-ai-sync-chat-window')ï¼›å¦åˆ™æ¿€æ´»ã€‚
4. å‘ä¸»çª—å£å‘ create æ¶ˆæ¯ï¼š{url, tabId, config}ã€‚

#### é˜¶æ®µ 2ï¼šä¸»çª—å£æ¸²æŸ“

1. è¯»å– localStorage é…ç½®ï¼ˆé™„å½• Cï¼‰ â†’ æ¸²æŸ“é¡¶éƒ¨æ ï¼ˆæ ‡é¢˜ã€è¯­è¨€ã€å¸ƒå±€ã€é…ç½®ã€æ–°å¯¹è¯ï¼‰ + åº•éƒ¨æç¤ºè¯æ ã€‚
2. æ ¹æ®å¸ƒå±€æ•°å­—ï¼ˆ1/2/3/4/6ï¼‰ç”Ÿæˆ div ç½‘æ ¼ï¼›æ¯ä¸ª div å†…æŒ‚ å†…å®¹å—ã€‚
3. å†…å®¹å— æ”¶åˆ° create â†’ åˆ›å»º iframe â†’ æ¸²æŸ“æ ‡é¢˜æ ä¸éšè—è¾“å…¥æ¡†ã€‚

#### é˜¶æ®µ 3ï¼šåŒå‘åŒæ­¥

1. ä¸»çª—å£å‘é€ chat æ¶ˆæ¯ â†’ åŸç”Ÿé¡µé¢å¡«è¾“å…¥æ¡†å¹¶ç‚¹å‡»å‘é€ã€‚
2. åŸç”Ÿé¡µé¢å›ç­”å®Œæˆåå‘é€ answer â†’ ä¸»çª—å£å¯¹åº” å†…å®¹å— æ¸²æŸ“ã€‚
3. å…¶ä½™æ¶ˆæ¯ï¼ˆconfig / thread / shareï¼‰åŒç†ï¼Œè§é™„å½• D åè®®ã€‚

### AI é©±åŠ¨æ˜ å°„è¡¨

é»˜è®¤æ”¯æŒçš„aiæä¾›å•†åŒ…æ‹¬å¦‚ä¸‹6ä¸ªï¼š

- <https://www.kimi.com/chat/>
- <https://gemini.google.com/>
- <https://chatgpt.com/>
- <https://chat.deepseek.com/>
- <https://x.com/i/grok>
- <https://www.tongyi.com/>

é¡µé¢å’Œé©±åŠ¨çš„å¯¹åº”å…³ç³»ä¸ºï¼škimi â†’ KimiPageDriver, gemini â†’ GeminiPageDriverä»¥æ­¤ç±»æ¨ã€‚æä¾›é€šç”¨é¡µé¢ç­–ç•¥GenericPageDriverå­˜æ”¾å…±æ€§ï¼Œä»¥åŠæœªæ¥çš„æ–°ä¾›åº”å•†æ”¯æŒã€‚

#### é€‰æ‹©å™¨è¯¦æƒ…

| é€‰æ‹©å™¨ç±»å‹ | GenericPageDriver | KimiPageDriver (ç»§æ‰¿è‡ªGeneric) | GeminiPageDriver (ç»§æ‰¿è‡ªGeneric) | ChatGPTPageDriver (ç»§æ‰¿è‡ªGeneric) |
| --- | --- | --- | --- | --- |
| `inputArea` | `input[type="text"]`, `textarea`, `.ql-editor`, `.chat-input-editor` | `#prompt-textarea` | `.ql-editor` | `#prompt-textarea` |
| `sendButton` | `button[type="submit"]`, `.send-button`, `.send-btn`, `button[aria-label="å‘é€"]` | `.send-button` | `button[aria-label="å‘é€"]`, `.send-button` | `[data-testid="send-button"]` |
| `chatHistory` | `.chat-messages`, `.messages`, `#chat-area`, `.chat-history-scroll-container` | `.chat-messages-container`, `.history-part` | `.chat-history-scroll-container`, `.conversations-container` | |
| `messageItem` | `.message`, `.chat-message`, `.conversation-container`, `.message-content` | `.message-item`, `li` | `.conversation-container`, `.conversation` | |
| `userMessage` | `.user-message`, `.segment-user`, `.user-query-container` | `.user-content` | `.query-text` | |
| `aiMessage` | `.ai-message`, `.segment-assistant`, `.model-response-container` | `.assistant-message`, `.chat-content-item-assistant` | `.model-response-container` | |
| `responseParagraph` | `.paragraph`, `div[class*="content"]`, `div[class*="response"]` | `.chat-name` | `.conversation-title` | |
| `newChatButton` | `.new-chat-button`, `.new-conversation`, `button[data-test-id="new-chat-button"]` | `.new-chat-btn` | `button[data-test-id="new-chat-button"]` | |
| `sessionTitle` | `h1.title`, `h2.session-title`, `.chat-header-content h2`, `.conversation-title` | `h2.session-title` | `h1.title` | |


### é€šè®¯åè®®è§„èŒƒ

- createï¼šåŸç”Ÿçª—å£é€šçŸ¥ä¸»çª—å£åˆ›å»ºä¸€ä¸ªå†…å®¹å—ï¼Œæºå¸¦å‚æ•°urlä¸ºåŸç”Ÿçª—å£çš„urlï¼ŒtabIdä¸ºæµè§ˆå™¨ä¸ºåŸç”Ÿçª—å£èµ‹äºˆçš„å”¯ä¸€åç§°ï¼Œconfigä¸ºä¸€ä¸ªjsonï¼ŒåŒ…å«åŸç”Ÿçª—å£ä¸­å„ç§é…ç½®æŒ‰é’®çš„çŠ¶æ€ï¼šç™»å½•ç”¨æˆ·åã€è”ç½‘æ¨¡å¼ã€æ¨¡å‹é€‰æ‹©ã€é•¿æ€è€ƒï¼Œä»¥åŠå…¶ä»–aiä¸“æœ‰çš„çŠ¶æ€ï¼ˆå¦‚grokçš„Xæœç´¢å¼€å…³ç­‰ï¼‰
- chatï¼šä¸»çª—å£é€šçŸ¥åŸç”Ÿçª—å£å¢åŠ ä¸€ä¸ªé—®é¢˜ï¼Œæºå¸¦å‚æ•°ä¸ºchatIdè¡¨ç¤ºé—®é¢˜çš„ç¼–å·ï¼ŒmessageåŒ…å«ç”¨æˆ·è¾“å…¥çš„æ–‡å­—ï¼ŒåŸç”Ÿçª—å£æ”¶åˆ°ä¹‹åå¾€è¾“å…¥å†…å®¹åŒºå¡«å†™æ–‡å­—å¹¶æ¨¡æ‹Ÿç‚¹å‡»å‘é€æŒ‰é’®ã€‚åœ¨æ¥æ”¶åˆ°aiçš„å›ç­”ä¹‹åï¼Œä¼šäº§ç”Ÿansweræ¶ˆæ¯å‘å›ç»™ä¸»çª—å£ã€‚
- answerï¼šåŸç”Ÿçª—å£é€šçŸ¥ä¸»çª—å£æœ‰å›ç­”äº†ï¼Œæºå¸¦å‚æ•°åŒ…æ‹¬urlã€tabIdã€chatIdï¼ŒanswerTimeä¸ºå›å¤æ—¥æœŸæ—¶é—´ï¼Œanswerä¸ºå›ç­”çš„innerhtmlå†…å®¹
- configï¼šä¸»çª—å£é€šçŸ¥åŸç”Ÿçª—å£è®¾ç½®å„ç§é…ç½®æŒ‰é’®çš„çŠ¶æ€ï¼Œæºå¸¦å‚æ•°ä¸ºé…ç½®æŒ‰é’®åè¯å’Œboolç±»å‹çš„å¼€å…³å€¼ï¼Œå‚è€ƒcreateçš„configè¯´æ˜
- thread_createï¼šä¸»çª—å£é€šçŸ¥åŸç”Ÿçª—å£ç»“æŸå½“å‰ä¼šè¯ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ã€‚åˆ›å»ºæ–°ä¼šè¯ä¹‹åä¼šåå‘å‘é€ä¸€ä¸ªthread_returnæ¶ˆæ¯
- thread_returnï¼šåŸç”Ÿçª—å£é€šçŸ¥ä¸»çª—å£ä¸€ä¸ªæ–°ä¼šè¯åˆ›å»ºå®Œæ¯•ï¼Œå‚æ•°è·Ÿcreateæ¶ˆæ¯ç›¸åŒ
- share_createï¼šä¸»çª—å£é€šçŸ¥åŸç”Ÿçª—å£åˆ›å»ºä¸€ä¸ªå¯¹è¯ä¿¡æ¯çš„shareé“¾æ¥ï¼Œæºå¸¦æ¶ˆæ¯ä¸ºchatIdçš„æ•°ç»„ã€‚æ ¹æ®ä¸åŒaiæä¾›å•†çš„ç‰¹æ€§ï¼Œå¯ä»¥æ‰§è¡Œæ•´ä¸ªä¼šè¯å…±äº«ã€é€‰æ‹©å¯¹è¯å…±äº«ã€å¦‚æœåªæœ‰ä¸€ä¸ªchatIdåˆ™å•ä¸ªå¯¹è¯å…±äº«ç­‰
- share_returnï¼šåŸç”Ÿçª—å£é€šçŸ¥ä¸»çª—å£

### localStorage ç»“æ„

- å­˜å‚¨ key å›ºå®šä¸º multi_ai_sync_config
- ç”¨å¦‚ä¸‹jsonç»“æ„å­˜å‚¨AIä¾›åº”å•†çš„é…ç½®ä¿¡æ¯ã€å¸ƒå±€ä¿¡æ¯å’Œè¯­è¨€è®¾ç½®

```json
{providers: [{name,url},â€¦], layout:3, lang:'zh'}
```

### å›½é™…åŒ–

- é»˜è®¤æ”¯æŒå¤šè¯­è¨€ï¼ŒåŒ…æ‹¬è‹±è¯­ã€ä¸­æ–‡ã€æ³•è¯­ã€æ—¥è¯­ã€æœé²œè¯­ã€è¥¿ç­ç‰™è¯­ã€è‘¡è„ç‰™è¯­ã€é˜¿æ‹‰ä¼¯è¯­
- æ ¹æ®æµè§ˆå™¨å½“å‰è¯­è¨€åˆ‡æ¢ï¼Œè¦æ³¨æ„é˜¿æ‹‰ä¼¯è¯­çš„ä»å³å‘å·¦çš„å†™ä½œæ–¹å¼çš„æ”¯æŒã€‚

## ğŸ’¡ å¸¸è§ä»»åŠ¡ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ·»åŠ å¯¹æ–° AI ç½‘ç«™çš„æ”¯æŒ (ä¾‹å¦‚ claude.ai)

**ç”¨æˆ·é—®é¢˜**: "æˆ‘éœ€è¦ä¸º 'claude.ai' æ·»åŠ åŒæ­¥æ”¯æŒã€‚"
**æœŸæœ›å›ç­”**:
å¥½çš„ã€‚ä¸ºäº†æ”¯æŒä¸€ä¸ªæ–°çš„ AI ç½‘ç«™ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„â€œé¡µé¢é©±åŠ¨ (PageDriver)â€ã€‚è¿™å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

1. **åˆ›å»ºé©±åŠ¨æ–‡ä»¶**: åœ¨ `src/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `claude-page-driver.js`ã€‚
2. **å®ç°é©±åŠ¨é€»è¾‘**: åœ¨ `claude-page-driver.js` ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª `ClaudePageDriver` æ„é€ å‡½æ•°ï¼Œå¹¶è®©å®ƒç»§æ‰¿è‡ª `GenericPageDriver`ã€‚ç„¶åï¼Œä½ éœ€è¦å®ç°æˆ–é‡å†™ç‰¹å®šäº `claude.ai` çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š
    - `getChatInput()`: è¿”å›èŠå¤©è¾“å…¥æ¡†çš„ DOM å…ƒç´ ã€‚
    - `getSendButton()`: è¿”å›å‘é€æŒ‰é’®çš„ DOM å…ƒç´ ã€‚
    - `getLastResponseElement()`: è¿”å› AI ç”Ÿæˆçš„æœ€æ–°å›ç­”æ‰€åœ¨çš„å®¹å™¨å…ƒç´ ã€‚
    - `getChatHistory()`: è·å–å¹¶æ ¼å¼åŒ–å†å²èŠå¤©è®°å½•ã€‚
3. **æ³¨å†Œæ–°é©±åŠ¨**: æ‰“å¼€ `src/drivers.js` æ–‡ä»¶ï¼Œåœ¨é©±åŠ¨æ˜ å°„è¡¨ä¸­æ·»åŠ æ–°çš„æ¡ç›®ï¼Œå°† `claude.ai` çš„ URL æ¨¡å¼æ˜ å°„åˆ°ä½ åˆšåˆšåˆ›å»ºçš„ `ClaudePageDriver`ã€‚

```javascript
// src/drivers.js
...
'chat.lmsys.org':        require('./vicuna-page-driver'),
'www.claude.ai':         require('./claude-page-driver'), // æ–°å¢æ­¤è¡Œ
'*':                     require('./generic-page-driver'),
...
```

4. **æ›´æ–°é»˜è®¤é…ç½®**: ï¼ˆå¯é€‰ï¼‰åœ¨ `main-window-controller.js` ä¸­æ‰¾åˆ°é»˜è®¤çš„ `providers` åˆ—è¡¨ï¼Œå¹¶å°† Claude æ·»åŠ è¿›å»ï¼Œè¿™æ ·æ–°ç”¨æˆ·åœ¨å®‰è£…è„šæœ¬åå°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚

è¿™ç§åŸºäºé©±åŠ¨çš„æ¶æ„å°†ç‰¹å®šç½‘ç«™çš„é€»è¾‘éš”ç¦»å¼€æ¥ï¼Œä½¿å¾—æ·»åŠ æ–°ç½‘ç«™å˜å¾—éå¸¸ç®€å•ï¼Œè€Œæ— éœ€æ”¹åŠ¨æ ¸å¿ƒä»£ç ã€‚

### åœ¨JSä¸­ç”ŸæˆHTML

**ç”¨æˆ·é—®é¢˜**ï¼šæˆ‘éœ€è¦ç”¨jsç”Ÿæˆä¸€ä¸ªå¼¹å‡ºå¼çª—å£åŒ…å«ç‰¹å®šåŠŸèƒ½çš„html

**æœŸæœ›å›ç­”**ï¼š

å¥½çš„ï¼Œä¸ºäº†ç”Ÿæˆä¸€ä¸ªæ–°çš„htmlé¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦åŒ…å«å¦‚ä¸‹çš„æ­¥éª¤ï¼š

1. ä¸ºé¡µé¢ç‰¹å®šçš„jsåˆ›å»ºç‰¹æœ‰çš„æ–‡ä»¶ï¼Œä¸€èˆ¬å‘½åä¸º `ABC_Script.js`ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰è¯¥çª—å£éœ€è¦çš„å‡½æ•°å’Œç±»å®šä¹‰ï¼Œå¹¶ä¸ºå…¶ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿å·¥ä½œæ­£ç¡®ã€‚

2. ä¸ºé¡µé¢åˆ›å»ºhtmlç”Ÿæˆçš„ä»£ç ç‰‡æ®µï¼Œä¸è¦åœ¨å…¶ä¸­ç›´æ¥åµŒå…¥javascriptè¯­å¥ï¼Œè€Œæ˜¯ç”¨Function.toStringåµŒå…¥æºç ï¼Œç¤ºä¾‹ä»£ç ï¼š

```javascript
const abc_html = `
    <html>
        <head><title>abc</title></head>
        <body>
            <div id="a1" style="color:red">
                <span>hello</span>
            </div>
            <div id="a2">world!</div>
            <script>${ABC_Script.toString()}</script>
        </body>
    </html>
`;
```

3. åœ¨å½“å‰jsè„šæœ¬æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„functionç”¨äºç”Ÿæˆçª—å£`function createABCWin(){...}`ï¼ŒæŠŠä»¥ä¸Šçš„ä»£ç åŒ…å«è¿›å»
